

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="zh" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="zh" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>4. Testpmd Runtime Functions &mdash; Data Plane Development Kit 17.05.0-rc4 文档</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="Network Interface Controller Drivers" href="../nics/index.html" />
    <link rel="prev" title="3. Running the Application" href="run_app.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Data Plane Development Kit
          

          
            
            <img src="../_static/DPDK_logo_vertical_rev_small.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                17.05.0-rc4
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../linux_gsg/index.html">Getting Started Guide for Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../freebsd_gsg/index.html">Getting Started Guide for FreeBSD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sample_app_ug/index.html">Sample Applications User Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../prog_guide/index.html">开发者指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../howto/index.html">HowTo Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">DPDK Tools User Guides</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Testpmd Application User Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="intro.html">1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="build_app.html">2. Compiling the Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="run_app.html">3. Running the Application</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">4. Testpmd Runtime Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#help-functions">4.1. Help Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#command-file-functions">4.2. Command File Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#control-functions">4.3. Control Functions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#start">4.3.1. start</a></li>
<li class="toctree-l4"><a class="reference internal" href="#start-tx-first">4.3.2. start tx_first</a></li>
<li class="toctree-l4"><a class="reference internal" href="#stop">4.3.3. stop</a></li>
<li class="toctree-l4"><a class="reference internal" href="#quit">4.3.4. quit</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#display-functions">4.4. Display Functions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#show-port">4.4.1. show port</a></li>
<li class="toctree-l4"><a class="reference internal" href="#show-port-rss-reta">4.4.2. show port rss reta</a></li>
<li class="toctree-l4"><a class="reference internal" href="#show-port-rss-hash">4.4.3. show port rss-hash</a></li>
<li class="toctree-l4"><a class="reference internal" href="#clear-port">4.4.4. clear port</a></li>
<li class="toctree-l4"><a class="reference internal" href="#show-rxq-txq">4.4.5. show (rxq|txq)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#show-config">4.4.6. show config</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-fwd">4.4.7. set fwd</a></li>
<li class="toctree-l4"><a class="reference internal" href="#read-rxd">4.4.8. read rxd</a></li>
<li class="toctree-l4"><a class="reference internal" href="#read-txd">4.4.9. read txd</a></li>
<li class="toctree-l4"><a class="reference internal" href="#show-vf-stats">4.4.10. show vf stats</a></li>
<li class="toctree-l4"><a class="reference internal" href="#clear-vf-stats">4.4.11. clear vf stats</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#configuration-functions">4.5. Configuration Functions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#set-default">4.5.1. set default</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-verbose">4.5.2. set verbose</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-nbport">4.5.3. set nbport</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-nbcore">4.5.4. set nbcore</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-coremask">4.5.5. set coremask</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-portmask">4.5.6. set portmask</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-burst">4.5.7. set burst</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-txpkts">4.5.8. set txpkts</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-txsplit">4.5.9. set txsplit</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-corelist">4.5.10. set corelist</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-portlist">4.5.11. set portlist</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-tx-loopback">4.5.12. set tx loopback</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-drop-enable">4.5.13. set drop enable</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-split-drop-enable-for-vf">4.5.14. set split drop enable (for VF)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-mac-antispoof-for-vf">4.5.15. set mac antispoof (for VF)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-macsec-offload">4.5.16. set macsec offload</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-macsec-sc">4.5.17. set macsec sc</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-macsec-sa">4.5.18. set macsec sa</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-broadcast-mode-for-vf">4.5.19. set broadcast mode (for VF)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#vlan-set-strip">4.5.20. vlan set strip</a></li>
<li class="toctree-l4"><a class="reference internal" href="#vlan-set-stripq">4.5.21. vlan set stripq</a></li>
<li class="toctree-l4"><a class="reference internal" href="#vlan-set-stripq-for-vf">4.5.22. vlan set stripq (for VF)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#vlan-set-insert-for-vf">4.5.23. vlan set insert (for VF)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#vlan-set-tag-for-vf">4.5.24. vlan set tag (for VF)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#vlan-set-antispoof-for-vf">4.5.25. vlan set antispoof (for VF)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#vlan-set-filter">4.5.26. vlan set filter</a></li>
<li class="toctree-l4"><a class="reference internal" href="#vlan-set-qinq">4.5.27. vlan set qinq</a></li>
<li class="toctree-l4"><a class="reference internal" href="#vlan-set-tpid">4.5.28. vlan set tpid</a></li>
<li class="toctree-l4"><a class="reference internal" href="#rx-vlan-add">4.5.29. rx_vlan add</a></li>
<li class="toctree-l4"><a class="reference internal" href="#rx-vlan-rm">4.5.30. rx_vlan rm</a></li>
<li class="toctree-l4"><a class="reference internal" href="#rx-vlan-add-for-vf">4.5.31. rx_vlan add (for VF)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#rx-vlan-rm-for-vf">4.5.32. rx_vlan rm (for VF)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tunnel-filter-add">4.5.33. tunnel_filter add</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tunnel-filter-remove">4.5.34. tunnel_filter remove</a></li>
<li class="toctree-l4"><a class="reference internal" href="#rx-vxlan-port-add">4.5.35. rx_vxlan_port add</a></li>
<li class="toctree-l4"><a class="reference internal" href="#rx-vxlan-port-remove">4.5.36. rx_vxlan_port remove</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tx-vlan-set">4.5.37. tx_vlan set</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tx-vlan-set-pvid">4.5.38. tx_vlan set pvid</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tx-vlan-reset">4.5.39. tx_vlan reset</a></li>
<li class="toctree-l4"><a class="reference internal" href="#csum-set">4.5.40. csum set</a></li>
<li class="toctree-l4"><a class="reference internal" href="#csum-parse-tunnel">4.5.41. csum parse-tunnel</a></li>
<li class="toctree-l4"><a class="reference internal" href="#csum-show">4.5.42. csum show</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tso-set">4.5.43. tso set</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tso-show">4.5.44. tso show</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mac-addr-add">4.5.45. mac_addr add</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mac-addr-remove">4.5.46. mac_addr remove</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mac-addr-add-for-vf">4.5.47. mac_addr add (for VF)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mac-addr-set">4.5.48. mac_addr set</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mac-addr-set-for-vf">4.5.49. mac_addr set (for VF)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-port-uta">4.5.50. set port-uta</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-promisc">4.5.51. set promisc</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-allmulti">4.5.52. set allmulti</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-promisc-for-vf">4.5.53. set promisc (for VF)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-allmulticast-for-vf">4.5.54. set allmulticast (for VF)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-tx-max-bandwidth-for-vf">4.5.55. set tx max bandwidth (for VF)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-tc-tx-min-bandwidth-for-vf">4.5.56. set tc tx min bandwidth (for VF)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-tc-tx-max-bandwidth-for-vf">4.5.57. set tc tx max bandwidth (for VF)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-tc-strict-link-priority-mode">4.5.58. set tc strict link priority mode</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-tc-tx-min-bandwidth">4.5.59. set tc tx min bandwidth</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-flow-ctrl-rx">4.5.60. set flow_ctrl rx</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-pfc-ctrl-rx">4.5.61. set pfc_ctrl rx</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-stat-qmap">4.5.62. set stat_qmap</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-port-rx-tx-for-vf">4.5.63. set port - rx/tx (for VF)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-port-mac-address-filter-for-vf">4.5.64. set port - mac address filter (for VF)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-port-rx-mode-for-vf">4.5.65. set port - rx mode(for VF)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-port-tx-rate-for-queue">4.5.66. set port - tx_rate (for Queue)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-port-tx-rate-for-vf">4.5.67. set port - tx_rate (for VF)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-port-mirror-rule">4.5.68. set port - mirror rule</a></li>
<li class="toctree-l4"><a class="reference internal" href="#reset-port-mirror-rule">4.5.69. reset port - mirror rule</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-flush-rx">4.5.70. set flush_rx</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-bypass-mode">4.5.71. set bypass mode</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-bypass-event">4.5.72. set bypass event</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-bypass-timeout">4.5.73. set bypass timeout</a></li>
<li class="toctree-l4"><a class="reference internal" href="#show-bypass-config">4.5.74. show bypass config</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-link-up">4.5.75. set link up</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-link-down">4.5.76. set link down</a></li>
<li class="toctree-l4"><a class="reference internal" href="#e-tag-set">4.5.77. E-tag set</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ptype-mapping">4.5.78. ptype mapping</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#port-functions">4.6. Port Functions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#port-attach">4.6.1. port attach</a></li>
<li class="toctree-l4"><a class="reference internal" href="#port-detach">4.6.2. port detach</a></li>
<li class="toctree-l4"><a class="reference internal" href="#port-start">4.6.3. port start</a></li>
<li class="toctree-l4"><a class="reference internal" href="#port-stop">4.6.4. port stop</a></li>
<li class="toctree-l4"><a class="reference internal" href="#port-close">4.6.5. port close</a></li>
<li class="toctree-l4"><a class="reference internal" href="#port-start-stop-queue">4.6.6. port start/stop queue</a></li>
<li class="toctree-l4"><a class="reference internal" href="#port-config-speed">4.6.7. port config - speed</a></li>
<li class="toctree-l4"><a class="reference internal" href="#port-config-queues-descriptors">4.6.8. port config - queues/descriptors</a></li>
<li class="toctree-l4"><a class="reference internal" href="#port-config-max-pkt-len">4.6.9. port config - max-pkt-len</a></li>
<li class="toctree-l4"><a class="reference internal" href="#port-config-crc-strip">4.6.10. port config - CRC Strip</a></li>
<li class="toctree-l4"><a class="reference internal" href="#port-config-scatter">4.6.11. port config - scatter</a></li>
<li class="toctree-l4"><a class="reference internal" href="#port-config-tx-queue-flags">4.6.12. port config - TX queue flags</a></li>
<li class="toctree-l4"><a class="reference internal" href="#port-config-rx-checksum">4.6.13. port config - RX Checksum</a></li>
<li class="toctree-l4"><a class="reference internal" href="#port-config-vlan">4.6.14. port config - VLAN</a></li>
<li class="toctree-l4"><a class="reference internal" href="#port-config-vlan-filter">4.6.15. port config - VLAN filter</a></li>
<li class="toctree-l4"><a class="reference internal" href="#port-config-vlan-strip">4.6.16. port config - VLAN strip</a></li>
<li class="toctree-l4"><a class="reference internal" href="#port-config-vlan-extend">4.6.17. port config - VLAN extend</a></li>
<li class="toctree-l4"><a class="reference internal" href="#port-config-drop-packets">4.6.18. port config - Drop Packets</a></li>
<li class="toctree-l4"><a class="reference internal" href="#port-config-rss">4.6.19. port config - RSS</a></li>
<li class="toctree-l4"><a class="reference internal" href="#port-config-rss-reta">4.6.20. port config - RSS Reta</a></li>
<li class="toctree-l4"><a class="reference internal" href="#port-config-dcb">4.6.21. port config - DCB</a></li>
<li class="toctree-l4"><a class="reference internal" href="#port-config-burst">4.6.22. port config - Burst</a></li>
<li class="toctree-l4"><a class="reference internal" href="#port-config-threshold">4.6.23. port config - Threshold</a></li>
<li class="toctree-l4"><a class="reference internal" href="#port-config-e-tag">4.6.24. port config - E-tag</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#link-bonding-functions">4.7. Link Bonding Functions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#create-bonded-device">4.7.1. create bonded device</a></li>
<li class="toctree-l4"><a class="reference internal" href="#add-bonding-slave">4.7.2. add bonding slave</a></li>
<li class="toctree-l4"><a class="reference internal" href="#remove-bonding-slave">4.7.3. remove bonding slave</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-bonding-mode">4.7.4. set bonding mode</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-bonding-primary">4.7.5. set bonding primary</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-bonding-mac">4.7.6. set bonding mac</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-bonding-xmit-balance-policy">4.7.7. set bonding xmit_balance_policy</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-bonding-mon-period">4.7.8. set bonding mon_period</a></li>
<li class="toctree-l4"><a class="reference internal" href="#show-bonding-config">4.7.9. show bonding config</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#register-functions">4.8. Register Functions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#read-reg">4.8.1. read reg</a></li>
<li class="toctree-l4"><a class="reference internal" href="#read-regfield">4.8.2. read regfield</a></li>
<li class="toctree-l4"><a class="reference internal" href="#read-regbit">4.8.3. read regbit</a></li>
<li class="toctree-l4"><a class="reference internal" href="#write-reg">4.8.4. write reg</a></li>
<li class="toctree-l4"><a class="reference internal" href="#write-regfield">4.8.5. write regfield</a></li>
<li class="toctree-l4"><a class="reference internal" href="#write-regbit">4.8.6. write regbit</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#filter-functions">4.9. Filter Functions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#ethertype-filter">4.9.1. ethertype_filter</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tuple-filter">4.9.2. 2tuple_filter</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id1">4.9.3. 5tuple_filter</a></li>
<li class="toctree-l4"><a class="reference internal" href="#syn-filter">4.9.4. syn_filter</a></li>
<li class="toctree-l4"><a class="reference internal" href="#flex-filter">4.9.5. flex_filter</a></li>
<li class="toctree-l4"><a class="reference internal" href="#flow-director-filter">4.9.6. flow_director_filter</a></li>
<li class="toctree-l4"><a class="reference internal" href="#flush-flow-director">4.9.7. flush_flow_director</a></li>
<li class="toctree-l4"><a class="reference internal" href="#flow-director-mask">4.9.8. flow_director_mask</a></li>
<li class="toctree-l4"><a class="reference internal" href="#flow-director-flex-mask">4.9.9. flow_director_flex_mask</a></li>
<li class="toctree-l4"><a class="reference internal" href="#flow-director-flex-payload">4.9.10. flow_director_flex_payload</a></li>
<li class="toctree-l4"><a class="reference internal" href="#get-sym-hash-ena-per-port">4.9.11. get_sym_hash_ena_per_port</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-sym-hash-ena-per-port">4.9.12. set_sym_hash_ena_per_port</a></li>
<li class="toctree-l4"><a class="reference internal" href="#get-hash-global-config">4.9.13. get_hash_global_config</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-hash-global-config">4.9.14. set_hash_global_config</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-hash-input-set">4.9.15. set_hash_input_set</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-fdir-input-set">4.9.16. set_fdir_input_set</a></li>
<li class="toctree-l4"><a class="reference internal" href="#global-config">4.9.17. global_config</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#flow-rules-management">4.10. Flow rules management</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#flow-syntax">4.10.1. <code class="docutils literal notranslate"><span class="pre">flow</span></code> syntax</a></li>
<li class="toctree-l4"><a class="reference internal" href="#validating-flow-rules">4.10.2. Validating flow rules</a></li>
<li class="toctree-l4"><a class="reference internal" href="#creating-flow-rules">4.10.3. Creating flow rules</a></li>
<li class="toctree-l4"><a class="reference internal" href="#destroying-flow-rules">4.10.4. Destroying flow rules</a></li>
<li class="toctree-l4"><a class="reference internal" href="#querying-flow-rules">4.10.5. Querying flow rules</a></li>
<li class="toctree-l4"><a class="reference internal" href="#listing-flow-rules">4.10.6. Listing flow rules</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sample-qinq-flow-rules">4.10.7. Sample QinQ flow rules</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../nics/index.html">Network Interface Controller Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cryptodevs/index.html">Crypto Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../eventdevs/index.html">Event Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../xen/index.html">Xen Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">Contributor's Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rel_notes/index.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/index.html">FAQ</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Data Plane Development Kit</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Testpmd Application User Guide</a> &raquo;</li>
        
      <li>4. Testpmd Runtime Functions</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/testpmd_app_ug/testpmd_funcs.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="testpmd-runtime-functions">
<span id="testpmd-runtime"></span><h1>4. Testpmd Runtime Functions</h1>
<p>Where the testpmd application is started in interactive mode, (<code class="docutils literal notranslate"><span class="pre">-i|--interactive</span></code>),
it displays a prompt that can be used to start and stop forwarding,
configure the application, display statistics (including the extended NIC
statistics aka xstats) , set the Flow Director and other tasks:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt;
</pre></div>
</div>
<p>The testpmd prompt has some, limited, readline support.
Common bash command-line functions such as <code class="docutils literal notranslate"><span class="pre">Ctrl+a</span></code> and <code class="docutils literal notranslate"><span class="pre">Ctrl+e</span></code> to go to the start and end of the prompt line are supported
as well as access to the command history via the up-arrow.</p>
<p>There is also support for tab completion.
If you type a partial command and hit <code class="docutils literal notranslate"><span class="pre">&lt;TAB&gt;</span></code> you get a list of the available completions:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">testpmd&gt; show port &lt;TAB&gt;</span>

<span class="go">    info [Mul-choice STRING]: show|clear port info|stats|xstats|fdir|stat_qmap|dcb_tc|cap X</span>
<span class="go">    info [Mul-choice STRING]: show|clear port info|stats|xstats|fdir|stat_qmap|dcb_tc|cap all</span>
<span class="go">    stats [Mul-choice STRING]: show|clear port info|stats|xstats|fdir|stat_qmap|dcb_tc|cap X</span>
<span class="go">    stats [Mul-choice STRING]: show|clear port info|stats|xstats|fdir|stat_qmap|dcb_tc|cap all</span>
<span class="go">    ...</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p>Some examples in this document are too long to fit on one line are are shown wrapped at <cite>&quot;\&quot;</cite> for display purposes:</p>
<div class="last highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set flow_ctrl rx (on|off) tx (on|off) (high_water) (low_water) \
         (pause_time) (send_xon) (port_id)
</pre></div>
</div>
</div>
<p>In the real <code class="docutils literal notranslate"><span class="pre">testpmd&gt;</span></code> prompt these commands should be on a single line.</p>
<div class="section" id="help-functions">
<h2>4.1. Help Functions</h2>
<p>The testpmd has on-line help for the functions that are available at runtime.
These are divided into sections and can be accessed using help, help section or help all:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">testpmd&gt; help</span>

<span class="go">    help control    : Start and stop forwarding.</span>
<span class="go">    help display    : Displaying port, stats and config information.</span>
<span class="go">    help config     : Configuration information.</span>
<span class="go">    help ports      : Configuring ports.</span>
<span class="go">    help registers  : Reading and setting port registers.</span>
<span class="go">    help filters    : Filters configuration help.</span>
<span class="go">    help all        : All of the above sections.</span>
</pre></div>
</div>
</div>
<div class="section" id="command-file-functions">
<h2>4.2. Command File Functions</h2>
<p>To facilitate loading large number of commands or to avoid cutting and pasting where not
practical or possible testpmd supports alternative methods for executing commands.</p>
<ul class="simple">
<li>If started with the <code class="docutils literal notranslate"><span class="pre">--cmdline-file=FILENAME</span></code> command line argument testpmd
will execute all CLI commands contained within the file immediately before
starting packet forwarding or entering interactive mode.</li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">./testpmd -n4 -r2 ... -- -i --cmdline-file=/home/ubuntu/flow-create-commands.txt</span>
<span class="go">Interactive-mode selected</span>
<span class="go">CLI commands to be read from /home/ubuntu/flow-create-commands.txt</span>
<span class="go">Configuring Port 0 (socket 0)</span>
<span class="go">Port 0: 7C:FE:90:CB:74:CE</span>
<span class="go">Configuring Port 1 (socket 0)</span>
<span class="go">Port 1: 7C:FE:90:CB:74:CA</span>
<span class="go">Checking link statuses...</span>
<span class="go">Port 0 Link Up - speed 10000 Mbps - full-duplex</span>
<span class="go">Port 1 Link Up - speed 10000 Mbps - full-duplex</span>
<span class="go">Done</span>
<span class="go">Flow rule #0 created</span>
<span class="go">Flow rule #1 created</span>
<span class="go">...</span>
<span class="go">...</span>
<span class="go">Flow rule #498 created</span>
<span class="go">Flow rule #499 created</span>
<span class="go">Read all CLI commands from /home/ubuntu/flow-create-commands.txt</span>
<span class="go">testpmd&gt;</span>
</pre></div>
</div>
<ul class="simple">
<li>At run-time additional commands can be loaded in bulk by invoking the <code class="docutils literal notranslate"><span class="pre">load</span> <span class="pre">FILENAME</span></code>
command.</li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">testpmd&gt; load /home/ubuntu/flow-create-commands.txt</span>
<span class="go">Flow rule #0 created</span>
<span class="go">Flow rule #1 created</span>
<span class="go">...</span>
<span class="go">...</span>
<span class="go">Flow rule #498 created</span>
<span class="go">Flow rule #499 created</span>
<span class="go">Read all CLI commands from /home/ubuntu/flow-create-commands.txt</span>
<span class="go">testpmd&gt;</span>
</pre></div>
</div>
<p>In all cases output from any included command will be displayed as standard output.
Execution will continue until the end of the file is reached regardless of
whether any errors occur.  The end user must examine the output to determine if
any failures occurred.</p>
</div>
<div class="section" id="control-functions">
<h2>4.3. Control Functions</h2>
<div class="section" id="start">
<h3>4.3.1. start</h3>
<p>Start packet forwarding with current configuration:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; start
</pre></div>
</div>
</div>
<div class="section" id="start-tx-first">
<h3>4.3.2. start tx_first</h3>
<p>Start packet forwarding with current configuration after sending specified number of bursts of packets:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; start tx_first (&quot;&quot;|burst_num)
</pre></div>
</div>
<p>The default burst number is 1 when <code class="docutils literal notranslate"><span class="pre">burst_num</span></code> not presented.</p>
</div>
<div class="section" id="stop">
<h3>4.3.3. stop</h3>
<p>Stop packet forwarding, and display accumulated statistics:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; stop
</pre></div>
</div>
</div>
<div class="section" id="quit">
<h3>4.3.4. quit</h3>
<p>Quit to prompt:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; quit
</pre></div>
</div>
</div>
</div>
<div class="section" id="display-functions">
<h2>4.4. Display Functions</h2>
<p>The functions in the following sections are used to display information about the
testpmd configuration or the NIC status.</p>
<div class="section" id="show-port">
<h3>4.4.1. show port</h3>
<p>Display information for a given port or all ports:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; show port (info|stats|xstats|fdir|stat_qmap|dcb_tc|cap) (port_id|all)
</pre></div>
</div>
<p>The available information categories are:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">info</span></code>: General port information such as MAC address.</li>
<li><code class="docutils literal notranslate"><span class="pre">stats</span></code>: RX/TX statistics.</li>
<li><code class="docutils literal notranslate"><span class="pre">xstats</span></code>: RX/TX extended NIC statistics.</li>
<li><code class="docutils literal notranslate"><span class="pre">fdir</span></code>: Flow Director information and statistics.</li>
<li><code class="docutils literal notranslate"><span class="pre">stat_qmap</span></code>: Queue statistics mapping.</li>
<li><code class="docutils literal notranslate"><span class="pre">dcb_tc</span></code>: DCB information such as TC mapping.</li>
<li><code class="docutils literal notranslate"><span class="pre">cap</span></code>: Supported offload capabilities.</li>
</ul>
<p>For example:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">testpmd&gt; show port info 0</span>

<span class="go">********************* Infos for port 0 *********************</span>

<span class="go">MAC address: XX:XX:XX:XX:XX:XX</span>
<span class="go">Connect to socket: 0</span>
<span class="go">memory allocation on the socket: 0</span>
<span class="go">Link status: up</span>
<span class="go">Link speed: 40000 Mbps</span>
<span class="go">Link duplex: full-duplex</span>
<span class="go">Promiscuous mode: enabled</span>
<span class="go">Allmulticast mode: disabled</span>
<span class="go">Maximum number of MAC addresses: 64</span>
<span class="go">Maximum number of MAC addresses of hash filtering: 0</span>
<span class="go">VLAN offload:</span>
<span class="go">    strip on</span>
<span class="go">    filter on</span>
<span class="go">    qinq(extend) off</span>
<span class="go">Redirection table size: 512</span>
<span class="go">Supported flow types:</span>
<span class="go">  ipv4-frag</span>
<span class="go">  ipv4-tcp</span>
<span class="go">  ipv4-udp</span>
<span class="go">  ipv4-sctp</span>
<span class="go">  ipv4-other</span>
<span class="go">  ipv6-frag</span>
<span class="go">  ipv6-tcp</span>
<span class="go">  ipv6-udp</span>
<span class="go">  ipv6-sctp</span>
<span class="go">  ipv6-other</span>
<span class="go">  l2_payload</span>
<span class="go">  port</span>
<span class="go">  vxlan</span>
<span class="go">  geneve</span>
<span class="go">  nvgre</span>
</pre></div>
</div>
</div>
<div class="section" id="show-port-rss-reta">
<h3>4.4.2. show port rss reta</h3>
<p>Display the rss redirection table entry indicated by masks on port X:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; show port (port_id) rss reta (size) (mask0, mask1...)
</pre></div>
</div>
<p>size is used to indicate the hardware supported reta size</p>
</div>
<div class="section" id="show-port-rss-hash">
<h3>4.4.3. show port rss-hash</h3>
<p>Display the RSS hash functions and RSS hash key of a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; show port (port_id) rss-hash ipv4|ipv4-frag|ipv4-tcp|ipv4-udp|ipv4-sctp|ipv4-other|ipv6|ipv6-frag|ipv6-tcp|ipv6-udp|ipv6-sctp|ipv6-other|l2-payload|ipv6-ex|ipv6-tcp-ex|ipv6-udp-ex [key]
</pre></div>
</div>
</div>
<div class="section" id="clear-port">
<h3>4.4.4. clear port</h3>
<p>Clear the port statistics for a given port or for all ports:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; clear port (info|stats|xstats|fdir|stat_qmap) (port_id|all)
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; clear port stats all
</pre></div>
</div>
</div>
<div class="section" id="show-rxq-txq">
<h3>4.4.5. show (rxq|txq)</h3>
<p>Display information for a given port's RX/TX queue:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; show (rxq|txq) info (port_id) (queue_id)
</pre></div>
</div>
</div>
<div class="section" id="show-config">
<h3>4.4.6. show config</h3>
<p>Displays the configuration of the application.
The configuration comes from the command-line, the runtime or the application defaults:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; show config (rxtx|cores|fwd|txpkts)
</pre></div>
</div>
<p>The available information categories are:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">rxtx</span></code>: RX/TX configuration items.</li>
<li><code class="docutils literal notranslate"><span class="pre">cores</span></code>: List of forwarding cores.</li>
<li><code class="docutils literal notranslate"><span class="pre">fwd</span></code>: Packet forwarding configuration.</li>
<li><code class="docutils literal notranslate"><span class="pre">txpkts</span></code>: Packets to TX configuration.</li>
</ul>
<p>For example:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">testpmd&gt; show config rxtx</span>

<span class="go">io packet forwarding - CRC stripping disabled - packets/burst=16</span>
<span class="go">nb forwarding cores=2 - nb forwarding ports=1</span>
<span class="go">RX queues=1 - RX desc=128 - RX free threshold=0</span>
<span class="go">RX threshold registers: pthresh=8 hthresh=8 wthresh=4</span>
<span class="go">TX queues=1 - TX desc=512 - TX free threshold=0</span>
<span class="go">TX threshold registers: pthresh=36 hthresh=0 wthresh=0</span>
<span class="go">TX RS bit threshold=0 - TXQ flags=0x0</span>
</pre></div>
</div>
</div>
<div class="section" id="set-fwd">
<h3>4.4.7. set fwd</h3>
<p>Set the packet forwarding mode:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set fwd (io|mac|macswap|flowgen| \
                  rxonly|txonly|csum|icmpecho) (&quot;&quot;|retry)
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">retry</span></code> can be specified for forwarding engines except <code class="docutils literal notranslate"><span class="pre">rx_only</span></code>.</p>
<p>The available information categories are:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">io</span></code>: Forwards packets &quot;as-is&quot; in I/O mode.
This is the fastest possible forwarding operation as it does not access packets data.
This is the default mode.</li>
<li><code class="docutils literal notranslate"><span class="pre">mac</span></code>: Changes the source and the destination Ethernet addresses of packets before forwarding them.
Default application behaviour is to set source Ethernet address to that of the transmitting interface, and destination
address to a dummy value (set during init). The user may specify a target destination Ethernet address via the 'eth-peer' or
'eth-peer-configfile' command-line options. It is not currently possible to specify a specific source Ethernet address.</li>
<li><code class="docutils literal notranslate"><span class="pre">macswap</span></code>: MAC swap forwarding mode.
Swaps the source and the destination Ethernet addresses of packets before forwarding them.</li>
<li><code class="docutils literal notranslate"><span class="pre">flowgen</span></code>: Multi-flow generation mode.
Originates a number of flows (with varying destination IP addresses), and terminate receive traffic.</li>
<li><code class="docutils literal notranslate"><span class="pre">rxonly</span></code>: Receives packets but doesn't transmit them.</li>
<li><code class="docutils literal notranslate"><span class="pre">txonly</span></code>: Generates and transmits packets without receiving any.</li>
<li><code class="docutils literal notranslate"><span class="pre">csum</span></code>: Changes the checksum field with hardware or software methods depending on the offload flags on the packet.</li>
<li><code class="docutils literal notranslate"><span class="pre">icmpecho</span></code>: Receives a burst of packets, lookup for IMCP echo requests and, if any, send back ICMP echo replies.</li>
<li><code class="docutils literal notranslate"><span class="pre">ieee1588</span></code>: Demonstrate L2 IEEE1588 V2 PTP timestamping for RX and TX. Requires <code class="docutils literal notranslate"><span class="pre">CONFIG_RTE_LIBRTE_IEEE1588=y</span></code>.</li>
</ul>
<p>Note: TX timestamping is only available in the &quot;Full Featured&quot; TX path. To force <code class="docutils literal notranslate"><span class="pre">testpmd</span></code> into this mode set <code class="docutils literal notranslate"><span class="pre">--txqflags=0</span></code>.</p>
<p>Example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set fwd rxonly

Set rxonly packet forwarding mode
</pre></div>
</div>
</div>
<div class="section" id="read-rxd">
<h3>4.4.8. read rxd</h3>
<p>Display an RX descriptor for a port RX queue:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; read rxd (port_id) (queue_id) (rxd_id)
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; read rxd 0 0 4
     0x0000000B - 0x001D0180 / 0x0000000B - 0x001D0180
</pre></div>
</div>
</div>
<div class="section" id="read-txd">
<h3>4.4.9. read txd</h3>
<p>Display a TX descriptor for a port TX queue:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; read txd (port_id) (queue_id) (txd_id)
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; read txd 0 0 4
     0x00000001 - 0x24C3C440 / 0x000F0000 - 0x2330003C
</pre></div>
</div>
</div>
<div class="section" id="show-vf-stats">
<h3>4.4.10. show vf stats</h3>
<p>Display VF statistics:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; show vf stats (port_id) (vf_id)
</pre></div>
</div>
</div>
<div class="section" id="clear-vf-stats">
<h3>4.4.11. clear vf stats</h3>
<p>Reset VF statistics:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; clear vf stats (port_id) (vf_id)
</pre></div>
</div>
</div>
</div>
<div class="section" id="configuration-functions">
<h2>4.5. Configuration Functions</h2>
<p>The testpmd application can be configured from the runtime as well as from the command-line.</p>
<p>This section details the available configuration functions that are available.</p>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">Configuration changes only become active when forwarding is started/restarted.</p>
</div>
<div class="section" id="set-default">
<h3>4.5.1. set default</h3>
<p>Reset forwarding to the default configuration:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set default
</pre></div>
</div>
</div>
<div class="section" id="set-verbose">
<h3>4.5.2. set verbose</h3>
<p>Set the debug verbosity level:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set verbose (level)
</pre></div>
</div>
<p>Currently the only available levels are 0 (silent except for error) and 1 (fully verbose).</p>
</div>
<div class="section" id="set-nbport">
<h3>4.5.3. set nbport</h3>
<p>Set the number of ports used by the application:</p>
<p>set nbport (num)</p>
<p>This is equivalent to the <code class="docutils literal notranslate"><span class="pre">--nb-ports</span></code> command-line option.</p>
</div>
<div class="section" id="set-nbcore">
<h3>4.5.4. set nbcore</h3>
<p>Set the number of cores used by the application:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set nbcore (num)
</pre></div>
</div>
<p>This is equivalent to the <code class="docutils literal notranslate"><span class="pre">--nb-cores</span></code> command-line option.</p>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">The number of cores used must not be greater than number of ports used multiplied by the number of queues per port.</p>
</div>
</div>
<div class="section" id="set-coremask">
<h3>4.5.5. set coremask</h3>
<p>Set the forwarding cores hexadecimal mask:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set coremask (mask)
</pre></div>
</div>
<p>This is equivalent to the <code class="docutils literal notranslate"><span class="pre">--coremask</span></code> command-line option.</p>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">The master lcore is reserved for command line parsing only and cannot be masked on for packet forwarding.</p>
</div>
</div>
<div class="section" id="set-portmask">
<h3>4.5.6. set portmask</h3>
<p>Set the forwarding ports hexadecimal mask:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set portmask (mask)
</pre></div>
</div>
<p>This is equivalent to the <code class="docutils literal notranslate"><span class="pre">--portmask</span></code> command-line option.</p>
</div>
<div class="section" id="set-burst">
<h3>4.5.7. set burst</h3>
<p>Set number of packets per burst:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set burst (num)
</pre></div>
</div>
<p>This is equivalent to the <code class="docutils literal notranslate"><span class="pre">--burst</span> <span class="pre">command-line</span></code> option.</p>
<p>When retry is enabled, the transmit delay time and number of retries can also be set:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set burst tx delay (microseconds) retry (num)
</pre></div>
</div>
</div>
<div class="section" id="set-txpkts">
<h3>4.5.8. set txpkts</h3>
<p>Set the length of each segment of the TX-ONLY packets or length of packet for FLOWGEN mode:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set txpkts (x[,y]*)
</pre></div>
</div>
<p>Where x[,y]* represents a CSV list of values, without white space.</p>
</div>
<div class="section" id="set-txsplit">
<h3>4.5.9. set txsplit</h3>
<p>Set the split policy for the TX packets, applicable for TX-ONLY and CSUM forwarding modes:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set txsplit (off|on|rand)
</pre></div>
</div>
<p>Where:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">off</span></code> disable packet copy &amp; split for CSUM mode.</li>
<li><code class="docutils literal notranslate"><span class="pre">on</span></code> split outgoing packet into multiple segments. Size of each segment
and number of segments per packet is determined by <code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">txpkts</span></code> command
(see above).</li>
<li><code class="docutils literal notranslate"><span class="pre">rand</span></code> same as 'on', but number of segments per each packet is a random value between 1 and total number of segments.</li>
</ul>
</div>
<div class="section" id="set-corelist">
<h3>4.5.10. set corelist</h3>
<p>Set the list of forwarding cores:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set corelist (x[,y]*)
</pre></div>
</div>
<p>For example, to change the forwarding cores:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">testpmd&gt; set corelist 3,1</span>
<span class="go">testpmd&gt; show config fwd</span>

<span class="go">io packet forwarding - ports=2 - cores=2 - streams=2 - NUMA support disabled</span>
<span class="go">Logical Core 3 (socket 0) forwards packets on 1 streams:</span>
<span class="go">RX P=0/Q=0 (socket 0) -&gt; TX P=1/Q=0 (socket 0) peer=02:00:00:00:00:01</span>
<span class="go">Logical Core 1 (socket 0) forwards packets on 1 streams:</span>
<span class="go">RX P=1/Q=0 (socket 0) -&gt; TX P=0/Q=0 (socket 0) peer=02:00:00:00:00:00</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">The cores are used in the same order as specified on the command line.</p>
</div>
</div>
<div class="section" id="set-portlist">
<h3>4.5.11. set portlist</h3>
<p>Set the list of forwarding ports:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set portlist (x[,y]*)
</pre></div>
</div>
<p>For example, to change the port forwarding:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">testpmd&gt; set portlist 0,2,1,3</span>
<span class="go">testpmd&gt; show config fwd</span>

<span class="go">io packet forwarding - ports=4 - cores=1 - streams=4</span>
<span class="go">Logical Core 3 (socket 0) forwards packets on 4 streams:</span>
<span class="go">RX P=0/Q=0 (socket 0) -&gt; TX P=2/Q=0 (socket 0) peer=02:00:00:00:00:01</span>
<span class="go">RX P=2/Q=0 (socket 0) -&gt; TX P=0/Q=0 (socket 0) peer=02:00:00:00:00:00</span>
<span class="go">RX P=1/Q=0 (socket 0) -&gt; TX P=3/Q=0 (socket 0) peer=02:00:00:00:00:03</span>
<span class="go">RX P=3/Q=0 (socket 0) -&gt; TX P=1/Q=0 (socket 0) peer=02:00:00:00:00:02</span>
</pre></div>
</div>
</div>
<div class="section" id="set-tx-loopback">
<h3>4.5.12. set tx loopback</h3>
<p>Enable/disable tx loopback:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set tx loopback (port_id) (on|off)
</pre></div>
</div>
</div>
<div class="section" id="set-drop-enable">
<h3>4.5.13. set drop enable</h3>
<p>set drop enable bit for all queues:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set all queues drop (port_id) (on|off)
</pre></div>
</div>
</div>
<div class="section" id="set-split-drop-enable-for-vf">
<h3>4.5.14. set split drop enable (for VF)</h3>
<p>set split drop enable bit for VF from PF:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set vf split drop (port_id) (vf_id) (on|off)
</pre></div>
</div>
</div>
<div class="section" id="set-mac-antispoof-for-vf">
<h3>4.5.15. set mac antispoof (for VF)</h3>
<p>Set mac antispoof for a VF from the PF:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set vf mac antispoof  (port_id) (vf_id) (on|off)
</pre></div>
</div>
</div>
<div class="section" id="set-macsec-offload">
<h3>4.5.16. set macsec offload</h3>
<p>Enable/disable MACsec offload:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set macsec offload (port_id) on encrypt (on|off) replay-protect (on|off)
testpmd&gt; set macsec offload (port_id) off
</pre></div>
</div>
</div>
<div class="section" id="set-macsec-sc">
<h3>4.5.17. set macsec sc</h3>
<p>Configure MACsec secure connection (SC):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set macsec sc (tx|rx) (port_id) (mac) (pi)
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">The pi argument is ignored for tx.
Check the NIC Datasheet for hardware limits.</p>
</div>
</div>
<div class="section" id="set-macsec-sa">
<h3>4.5.18. set macsec sa</h3>
<p>Configure MACsec secure association (SA):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set macsec sa (tx|rx) (port_id) (idx) (an) (pn) (key)
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">The IDX value must be 0 or 1.
Check the NIC Datasheet for hardware limits.</p>
</div>
</div>
<div class="section" id="set-broadcast-mode-for-vf">
<h3>4.5.19. set broadcast mode (for VF)</h3>
<p>Set broadcast mode for a VF from the PF:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set vf broadcast (port_id) (vf_id) (on|off)
</pre></div>
</div>
</div>
<div class="section" id="vlan-set-strip">
<h3>4.5.20. vlan set strip</h3>
<p>Set the VLAN strip on a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; vlan set strip (on|off) (port_id)
</pre></div>
</div>
</div>
<div class="section" id="vlan-set-stripq">
<h3>4.5.21. vlan set stripq</h3>
<p>Set the VLAN strip for a queue on a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; vlan set stripq (on|off) (port_id,queue_id)
</pre></div>
</div>
</div>
<div class="section" id="vlan-set-stripq-for-vf">
<h3>4.5.22. vlan set stripq (for VF)</h3>
<p>Set VLAN strip for all queues in a pool for a VF from the PF:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set vf vlan stripq (port_id) (vf_id) (on|off)
</pre></div>
</div>
</div>
<div class="section" id="vlan-set-insert-for-vf">
<h3>4.5.23. vlan set insert (for VF)</h3>
<p>Set VLAN insert for a VF from the PF:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set vf vlan insert (port_id) (vf_id) (vlan_id)
</pre></div>
</div>
</div>
<div class="section" id="vlan-set-tag-for-vf">
<h3>4.5.24. vlan set tag (for VF)</h3>
<p>Set VLAN tag for a VF from the PF:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set vf vlan tag (port_id) (vf_id) (on|off)
</pre></div>
</div>
</div>
<div class="section" id="vlan-set-antispoof-for-vf">
<h3>4.5.25. vlan set antispoof (for VF)</h3>
<p>Set VLAN antispoof for a VF from the PF:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set vf vlan antispoof (port_id) (vf_id) (on|off)
</pre></div>
</div>
</div>
<div class="section" id="vlan-set-filter">
<h3>4.5.26. vlan set filter</h3>
<p>Set the VLAN filter on a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; vlan set filter (on|off) (port_id)
</pre></div>
</div>
</div>
<div class="section" id="vlan-set-qinq">
<h3>4.5.27. vlan set qinq</h3>
<p>Set the VLAN QinQ (extended queue in queue) on for a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; vlan set qinq (on|off) (port_id)
</pre></div>
</div>
</div>
<div class="section" id="vlan-set-tpid">
<h3>4.5.28. vlan set tpid</h3>
<p>Set the inner or outer VLAN TPID for packet filtering on a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; vlan set (inner|outer) tpid (value) (port_id)
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">TPID value must be a 16-bit number (value &lt;= 65536).</p>
</div>
</div>
<div class="section" id="rx-vlan-add">
<h3>4.5.29. rx_vlan add</h3>
<p>Add a VLAN ID, or all identifiers, to the set of VLAN identifiers filtered by port ID:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; rx_vlan add (vlan_id|all) (port_id)
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">VLAN filter must be set on that port. VLAN ID &lt; 4096.
Depending on the NIC used, number of vlan_ids may be limited to the maximum entries
in VFTA table. This is important if enabling all vlan_ids.</p>
</div>
</div>
<div class="section" id="rx-vlan-rm">
<h3>4.5.30. rx_vlan rm</h3>
<p>Remove a VLAN ID, or all identifiers, from the set of VLAN identifiers filtered by port ID:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; rx_vlan rm (vlan_id|all) (port_id)
</pre></div>
</div>
</div>
<div class="section" id="rx-vlan-add-for-vf">
<h3>4.5.31. rx_vlan add (for VF)</h3>
<p>Add a VLAN ID, to the set of VLAN identifiers filtered for VF(s) for port ID:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; rx_vlan add (vlan_id) port (port_id) vf (vf_mask)
</pre></div>
</div>
</div>
<div class="section" id="rx-vlan-rm-for-vf">
<h3>4.5.32. rx_vlan rm (for VF)</h3>
<p>Remove a VLAN ID, from the set of VLAN identifiers filtered for VF(s) for port ID:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; rx_vlan rm (vlan_id) port (port_id) vf (vf_mask)
</pre></div>
</div>
</div>
<div class="section" id="tunnel-filter-add">
<h3>4.5.33. tunnel_filter add</h3>
<p>Add a tunnel filter on a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; tunnel_filter add (port_id) (outer_mac) (inner_mac) (ip_addr) \
         (inner_vlan) (vxlan|nvgre|ipingre) (imac-ivlan|imac-ivlan-tenid|\
         imac-tenid|imac|omac-imac-tenid|oip|iip) (tenant_id) (queue_id)
</pre></div>
</div>
<p>The available information categories are:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">vxlan</span></code>: Set tunnel type as VXLAN.</li>
<li><code class="docutils literal notranslate"><span class="pre">nvgre</span></code>: Set tunnel type as NVGRE.</li>
<li><code class="docutils literal notranslate"><span class="pre">ipingre</span></code>: Set tunnel type as IP-in-GRE.</li>
<li><code class="docutils literal notranslate"><span class="pre">imac-ivlan</span></code>: Set filter type as Inner MAC and VLAN.</li>
<li><code class="docutils literal notranslate"><span class="pre">imac-ivlan-tenid</span></code>: Set filter type as Inner MAC, VLAN and tenant ID.</li>
<li><code class="docutils literal notranslate"><span class="pre">imac-tenid</span></code>: Set filter type as Inner MAC and tenant ID.</li>
<li><code class="docutils literal notranslate"><span class="pre">imac</span></code>: Set filter type as Inner MAC.</li>
<li><code class="docutils literal notranslate"><span class="pre">omac-imac-tenid</span></code>: Set filter type as Outer MAC, Inner MAC and tenant ID.</li>
<li><code class="docutils literal notranslate"><span class="pre">oip</span></code>: Set filter type as Outer IP.</li>
<li><code class="docutils literal notranslate"><span class="pre">iip</span></code>: Set filter type as Inner IP.</li>
</ul>
<p>Example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; tunnel_filter add 0 68:05:CA:28:09:82 00:00:00:00:00:00 \
         192.168.2.2 0 ipingre oip 1 1

Set an IP-in-GRE tunnel on port 0, and the filter type is Outer IP.
</pre></div>
</div>
</div>
<div class="section" id="tunnel-filter-remove">
<h3>4.5.34. tunnel_filter remove</h3>
<p>Remove a tunnel filter on a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; tunnel_filter rm (port_id) (outer_mac) (inner_mac) (ip_addr) \
         (inner_vlan) (vxlan|nvgre|ipingre) (imac-ivlan|imac-ivlan-tenid|\
         imac-tenid|imac|omac-imac-tenid|oip|iip) (tenant_id) (queue_id)
</pre></div>
</div>
</div>
<div class="section" id="rx-vxlan-port-add">
<h3>4.5.35. rx_vxlan_port add</h3>
<p>Add an UDP port for VXLAN packet filter on a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; rx_vxlan_port add (udp_port) (port_id)
</pre></div>
</div>
</div>
<div class="section" id="rx-vxlan-port-remove">
<h3>4.5.36. rx_vxlan_port remove</h3>
<p>Remove an UDP port for VXLAN packet filter on a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; rx_vxlan_port rm (udp_port) (port_id)
</pre></div>
</div>
</div>
<div class="section" id="tx-vlan-set">
<h3>4.5.37. tx_vlan set</h3>
<p>Set hardware insertion of VLAN IDs in packets sent on a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; tx_vlan set (port_id) vlan_id[, vlan_id_outer]
</pre></div>
</div>
<p>For example, set a single VLAN ID (5) insertion on port 0:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>tx_vlan set 0 5
</pre></div>
</div>
<p>Or, set double VLAN ID (inner: 2, outer: 3) insertion on port 1:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>tx_vlan set 1 2 3
</pre></div>
</div>
</div>
<div class="section" id="tx-vlan-set-pvid">
<h3>4.5.38. tx_vlan set pvid</h3>
<p>Set port based hardware insertion of VLAN ID in packets sent on a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; tx_vlan set pvid (port_id) (vlan_id) (on|off)
</pre></div>
</div>
</div>
<div class="section" id="tx-vlan-reset">
<h3>4.5.39. tx_vlan reset</h3>
<p>Disable hardware insertion of a VLAN header in packets sent on a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; tx_vlan reset (port_id)
</pre></div>
</div>
</div>
<div class="section" id="csum-set">
<h3>4.5.40. csum set</h3>
<p>Select hardware or software calculation of the checksum when
transmitting a packet using the <code class="docutils literal notranslate"><span class="pre">csum</span></code> forwarding engine:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; csum set (ip|udp|tcp|sctp|outer-ip) (hw|sw) (port_id)
</pre></div>
</div>
<p>Where:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">ip|udp|tcp|sctp</span></code> always relate to  the inner layer.</li>
<li><code class="docutils literal notranslate"><span class="pre">outer-ip</span></code> relates to the outer IP layer (only for IPv4) in the case where the packet is recognized
as a tunnel packet by the forwarding engine (vxlan, gre and ipip are
supported). See also the <code class="docutils literal notranslate"><span class="pre">csum</span> <span class="pre">parse-tunnel</span></code> command.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">Check the NIC Datasheet for hardware limits.</p>
</div>
</div>
<div class="section" id="csum-parse-tunnel">
<h3>4.5.41. csum parse-tunnel</h3>
<p>Define how tunneled packets should be handled by the csum forward
engine:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; csum parse-tunnel (on|off) (tx_port_id)
</pre></div>
</div>
<p>If enabled, the csum forward engine will try to recognize supported
tunnel headers (vxlan, gre, ipip).</p>
<p>If disabled, treat tunnel packets as non-tunneled packets (a inner
header is handled as a packet payload).</p>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">The port argument is the TX port like in the <code class="docutils literal notranslate"><span class="pre">csum</span> <span class="pre">set</span></code> command.</p>
</div>
<p>Example:</p>
<p>Consider a packet in packet like the following:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>eth_out/ipv4_out/udp_out/vxlan/eth_in/ipv4_in/tcp_in
</pre></div>
</div>
<ul class="simple">
<li>If parse-tunnel is enabled, the <code class="docutils literal notranslate"><span class="pre">ip|udp|tcp|sctp</span></code> parameters of <code class="docutils literal notranslate"><span class="pre">csum</span> <span class="pre">set</span></code>
command relate to the inner headers (here <code class="docutils literal notranslate"><span class="pre">ipv4_in</span></code> and <code class="docutils literal notranslate"><span class="pre">tcp_in</span></code>), and the
<code class="docutils literal notranslate"><span class="pre">outer-ip</span> <span class="pre">parameter</span></code> relates to the outer headers (here <code class="docutils literal notranslate"><span class="pre">ipv4_out</span></code>).</li>
<li><dl class="first docutils">
<dt>If parse-tunnel is disabled, the <code class="docutils literal notranslate"><span class="pre">ip|udp|tcp|sctp</span></code> parameters of <code class="docutils literal notranslate"><span class="pre">csum</span>&#160; <span class="pre">set</span></code></dt>
<dd>command relate to the outer headers, here <code class="docutils literal notranslate"><span class="pre">ipv4_out</span></code> and <code class="docutils literal notranslate"><span class="pre">udp_out</span></code>.</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="csum-show">
<h3>4.5.42. csum show</h3>
<p>Display tx checksum offload configuration:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; csum show (port_id)
</pre></div>
</div>
</div>
<div class="section" id="tso-set">
<h3>4.5.43. tso set</h3>
<p>Enable TCP Segmentation Offload (TSO) in the <code class="docutils literal notranslate"><span class="pre">csum</span></code> forwarding engine:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; tso set (segsize) (port_id)
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">Check the NIC datasheet for hardware limits.</p>
</div>
</div>
<div class="section" id="tso-show">
<h3>4.5.44. tso show</h3>
<p>Display the status of TCP Segmentation Offload:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; tso show (port_id)
</pre></div>
</div>
</div>
<div class="section" id="mac-addr-add">
<h3>4.5.45. mac_addr add</h3>
<p>Add an alternative MAC address to a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; mac_addr add (port_id) (XX:XX:XX:XX:XX:XX)
</pre></div>
</div>
</div>
<div class="section" id="mac-addr-remove">
<h3>4.5.46. mac_addr remove</h3>
<p>Remove a MAC address from a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; mac_addr remove (port_id) (XX:XX:XX:XX:XX:XX)
</pre></div>
</div>
</div>
<div class="section" id="mac-addr-add-for-vf">
<h3>4.5.47. mac_addr add (for VF)</h3>
<p>Add an alternative MAC address for a VF to a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; mac_add add port (port_id) vf (vf_id) (XX:XX:XX:XX:XX:XX)
</pre></div>
</div>
</div>
<div class="section" id="mac-addr-set">
<h3>4.5.48. mac_addr set</h3>
<p>Set the default MAC address for a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; mac_addr set (port_id) (XX:XX:XX:XX:XX:XX)
</pre></div>
</div>
</div>
<div class="section" id="mac-addr-set-for-vf">
<h3>4.5.49. mac_addr set (for VF)</h3>
<p>Set the MAC address for a VF from the PF:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set vf mac addr (port_id) (vf_id) (XX:XX:XX:XX:XX:XX)
</pre></div>
</div>
</div>
<div class="section" id="set-port-uta">
<h3>4.5.50. set port-uta</h3>
<p>Set the unicast hash filter(s) on/off for a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set port (port_id) uta (XX:XX:XX:XX:XX:XX|all) (on|off)
</pre></div>
</div>
</div>
<div class="section" id="set-promisc">
<h3>4.5.51. set promisc</h3>
<p>Set the promiscuous mode on for a port or for all ports.
In promiscuous mode packets are not dropped if they aren't for the specified MAC address:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set promisc (port_id|all) (on|off)
</pre></div>
</div>
</div>
<div class="section" id="set-allmulti">
<h3>4.5.52. set allmulti</h3>
<p>Set the allmulti mode for a port or for all ports:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set allmulti (port_id|all) (on|off)
</pre></div>
</div>
<p>Same as the ifconfig (8) option. Controls how multicast packets are handled.</p>
</div>
<div class="section" id="set-promisc-for-vf">
<h3>4.5.53. set promisc (for VF)</h3>
<p>Set the unicast promiscuous mode for a VF from PF.
It's supported by Intel i40e NICs now.
In promiscuous mode packets are not dropped if they aren't for the specified MAC address:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set vf promisc (port_id) (vf_id) (on|off)
</pre></div>
</div>
</div>
<div class="section" id="set-allmulticast-for-vf">
<h3>4.5.54. set allmulticast (for VF)</h3>
<p>Set the multicast promiscuous mode for a VF from PF.
It's supported by Intel i40e NICs now.
In promiscuous mode packets are not dropped if they aren't for the specified MAC address:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set vf allmulti (port_id) (vf_id) (on|off)
</pre></div>
</div>
</div>
<div class="section" id="set-tx-max-bandwidth-for-vf">
<h3>4.5.55. set tx max bandwidth (for VF)</h3>
<p>Set TX max absolute bandwidth (Mbps) for a VF from PF:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set vf tx max-bandwidth (port_id) (vf_id) (max_bandwidth)
</pre></div>
</div>
</div>
<div class="section" id="set-tc-tx-min-bandwidth-for-vf">
<h3>4.5.56. set tc tx min bandwidth (for VF)</h3>
<p>Set all TCs' TX min relative bandwidth (%) for a VF from PF:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set vf tc tx min-bandwidth (port_id) (vf_id) (bw1, bw2, ...)
</pre></div>
</div>
</div>
<div class="section" id="set-tc-tx-max-bandwidth-for-vf">
<h3>4.5.57. set tc tx max bandwidth (for VF)</h3>
<p>Set a TC's TX max absolute bandwidth (Mbps) for a VF from PF:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set vf tc tx max-bandwidth (port_id) (vf_id) (tc_no) (max_bandwidth)
</pre></div>
</div>
</div>
<div class="section" id="set-tc-strict-link-priority-mode">
<h3>4.5.58. set tc strict link priority mode</h3>
<p>Set some TCs' strict link priority mode on a physical port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set tx strict-link-priority (port_id) (tc_bitmap)
</pre></div>
</div>
</div>
<div class="section" id="set-tc-tx-min-bandwidth">
<h3>4.5.59. set tc tx min bandwidth</h3>
<p>Set all TCs' TX min relative bandwidth (%) globally for all PF and VFs:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set tc tx min-bandwidth (port_id) (bw1, bw2, ...)
</pre></div>
</div>
</div>
<div class="section" id="set-flow-ctrl-rx">
<h3>4.5.60. set flow_ctrl rx</h3>
<p>Set the link flow control parameter on a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set flow_ctrl rx (on|off) tx (on|off) (high_water) (low_water) \
         (pause_time) (send_xon) mac_ctrl_frame_fwd (on|off) \
         autoneg (on|off) (port_id)
</pre></div>
</div>
<p>Where:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">high_water</span></code> (integer): High threshold value to trigger XOFF.</li>
<li><code class="docutils literal notranslate"><span class="pre">low_water</span></code> (integer): Low threshold value to trigger XON.</li>
<li><code class="docutils literal notranslate"><span class="pre">pause_time</span></code> (integer): Pause quota in the Pause frame.</li>
<li><code class="docutils literal notranslate"><span class="pre">send_xon</span></code> (0/1): Send XON frame.</li>
<li><code class="docutils literal notranslate"><span class="pre">mac_ctrl_frame_fwd</span></code>: Enable receiving MAC control frames.</li>
<li><code class="docutils literal notranslate"><span class="pre">autoneg</span></code>: Change the auto-negotiation parameter.</li>
</ul>
</div>
<div class="section" id="set-pfc-ctrl-rx">
<h3>4.5.61. set pfc_ctrl rx</h3>
<p>Set the priority flow control parameter on a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set pfc_ctrl rx (on|off) tx (on|off) (high_water) (low_water) \
         (pause_time) (priority) (port_id)
</pre></div>
</div>
<p>Where:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">high_water</span></code> (integer): High threshold value.</li>
<li><code class="docutils literal notranslate"><span class="pre">low_water</span></code> (integer): Low threshold value.</li>
<li><code class="docutils literal notranslate"><span class="pre">pause_time</span></code> (integer): Pause quota in the Pause frame.</li>
<li><code class="docutils literal notranslate"><span class="pre">priority</span></code> (0-7): VLAN User Priority.</li>
</ul>
</div>
<div class="section" id="set-stat-qmap">
<h3>4.5.62. set stat_qmap</h3>
<p>Set statistics mapping (qmapping 0..15) for RX/TX queue on port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set stat_qmap (tx|rx) (port_id) (queue_id) (qmapping)
</pre></div>
</div>
<p>For example, to set rx queue 2 on port 0 to mapping 5:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt;set stat_qmap rx 0 2 5
</pre></div>
</div>
</div>
<div class="section" id="set-port-rx-tx-for-vf">
<h3>4.5.63. set port - rx/tx (for VF)</h3>
<p>Set VF receive/transmit from a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set port (port_id) vf (vf_id) (rx|tx) (on|off)
</pre></div>
</div>
</div>
<div class="section" id="set-port-mac-address-filter-for-vf">
<h3>4.5.64. set port - mac address filter (for VF)</h3>
<p>Add/Remove unicast or multicast MAC addr filter for a VF:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set port (port_id) vf (vf_id) (mac_addr) \
         (exact-mac|exact-mac-vlan|hashmac|hashmac-vlan) (on|off)
</pre></div>
</div>
</div>
<div class="section" id="set-port-rx-mode-for-vf">
<h3>4.5.65. set port - rx mode(for VF)</h3>
<p>Set the VF receive mode of a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set port (port_id) vf (vf_id) \
         rxmode (AUPE|ROPE|BAM|MPE) (on|off)
</pre></div>
</div>
<p>The available receive modes are:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">AUPE</span></code>: Accepts untagged VLAN.</li>
<li><code class="docutils literal notranslate"><span class="pre">ROPE</span></code>: Accepts unicast hash.</li>
<li><code class="docutils literal notranslate"><span class="pre">BAM</span></code>: Accepts broadcast packets.</li>
<li><code class="docutils literal notranslate"><span class="pre">MPE</span></code>: Accepts all multicast packets.</li>
</ul>
</div>
<div class="section" id="set-port-tx-rate-for-queue">
<h3>4.5.66. set port - tx_rate (for Queue)</h3>
<p>Set TX rate limitation for a queue on a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set port (port_id) queue (queue_id) rate (rate_value)
</pre></div>
</div>
</div>
<div class="section" id="set-port-tx-rate-for-vf">
<h3>4.5.67. set port - tx_rate (for VF)</h3>
<p>Set TX rate limitation for queues in VF on a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set port (port_id) vf (vf_id) rate (rate_value) queue_mask (queue_mask)
</pre></div>
</div>
</div>
<div class="section" id="set-port-mirror-rule">
<h3>4.5.68. set port - mirror rule</h3>
<p>Set pool or vlan type mirror rule for a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set port (port_id) mirror-rule (rule_id) \
         (pool-mirror-up|pool-mirror-down|vlan-mirror) \
         (poolmask|vlanid[,vlanid]*) dst-pool (pool_id) (on|off)
</pre></div>
</div>
<p>Set link mirror rule for a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set port (port_id) mirror-rule (rule_id) \
        (uplink-mirror|downlink-mirror) dst-pool (pool_id) (on|off)
</pre></div>
</div>
<p>For example to enable mirror traffic with vlan 0,1 to pool 0:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set port 0 mirror-rule 0 vlan-mirror 0,1 dst-pool 0 on
</pre></div>
</div>
</div>
<div class="section" id="reset-port-mirror-rule">
<h3>4.5.69. reset port - mirror rule</h3>
<p>Reset a mirror rule for a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; reset port (port_id) mirror-rule (rule_id)
</pre></div>
</div>
</div>
<div class="section" id="set-flush-rx">
<h3>4.5.70. set flush_rx</h3>
<p>Set the flush on RX streams before forwarding.
The default is flush <code class="docutils literal notranslate"><span class="pre">on</span></code>.
Mainly used with PCAP drivers to turn off the default behavior of flushing the first 512 packets on RX streams:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set flush_rx off
</pre></div>
</div>
</div>
<div class="section" id="set-bypass-mode">
<h3>4.5.71. set bypass mode</h3>
<p>Set the bypass mode for the lowest port on bypass enabled NIC:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set bypass mode (normal|bypass|isolate) (port_id)
</pre></div>
</div>
</div>
<div class="section" id="set-bypass-event">
<h3>4.5.72. set bypass event</h3>
<p>Set the event required to initiate specified bypass mode for the lowest port on a bypass enabled:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set bypass event (timeout|os_on|os_off|power_on|power_off) \
         mode (normal|bypass|isolate) (port_id)
</pre></div>
</div>
<p>Where:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">timeout</span></code>: Enable bypass after watchdog timeout.</li>
<li><code class="docutils literal notranslate"><span class="pre">os_on</span></code>: Enable bypass when OS/board is powered on.</li>
<li><code class="docutils literal notranslate"><span class="pre">os_off</span></code>: Enable bypass when OS/board is powered off.</li>
<li><code class="docutils literal notranslate"><span class="pre">power_on</span></code>: Enable bypass when power supply is turned on.</li>
<li><code class="docutils literal notranslate"><span class="pre">power_off</span></code>: Enable bypass when power supply is turned off.</li>
</ul>
</div>
<div class="section" id="set-bypass-timeout">
<h3>4.5.73. set bypass timeout</h3>
<p>Set the bypass watchdog timeout to <code class="docutils literal notranslate"><span class="pre">n</span></code> seconds where 0 = instant:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set bypass timeout (0|1.5|2|3|4|8|16|32)
</pre></div>
</div>
</div>
<div class="section" id="show-bypass-config">
<h3>4.5.74. show bypass config</h3>
<p>Show the bypass configuration for a bypass enabled NIC using the lowest port on the NIC:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; show bypass config (port_id)
</pre></div>
</div>
</div>
<div class="section" id="set-link-up">
<h3>4.5.75. set link up</h3>
<p>Set link up for a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set link-up port (port id)
</pre></div>
</div>
</div>
<div class="section" id="set-link-down">
<h3>4.5.76. set link down</h3>
<p>Set link down for a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set link-down port (port id)
</pre></div>
</div>
</div>
<div class="section" id="e-tag-set">
<h3>4.5.77. E-tag set</h3>
<p>Enable E-tag insertion for a VF on a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; E-tag set insertion on port-tag-id (value) port (port_id) vf (vf_id)
</pre></div>
</div>
<p>Disable E-tag insertion for a VF on a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; E-tag set insertion off port (port_id) vf (vf_id)
</pre></div>
</div>
<p>Enable/disable E-tag stripping on a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; E-tag set stripping (on|off) port (port_id)
</pre></div>
</div>
<p>Enable/disable E-tag based forwarding on a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; E-tag set forwarding (on|off) port (port_id)
</pre></div>
</div>
<p>Add an E-tag forwarding filter on a port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; E-tag set filter add e-tag-id (value) dst-pool (pool_id) port (port_id)
</pre></div>
</div>
<dl class="docutils">
<dt>Delete an E-tag forwarding filter on a port::</dt>
<dd>testpmd&gt; E-tag set filter del e-tag-id (value) port (port_id)</dd>
</dl>
</div>
<div class="section" id="ptype-mapping">
<h3>4.5.78. ptype mapping</h3>
<p>List all items from the ptype mapping table:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; ptype mapping get (port_id) (valid_only)
</pre></div>
</div>
<p>Where:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">valid_only</span></code>: A flag indicates if only list valid items(=1) or all itemss(=0).</li>
</ul>
<p>Replace a specific or a group of software defined ptype with a new one:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; ptype mapping replace  (port_id) (target) (mask) (pkt_type)
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">target</span></code>: A specific software ptype or a mask to represent a group of software ptypes.</li>
<li><code class="docutils literal notranslate"><span class="pre">mask</span></code>: A flag indicate if &quot;target&quot; is a specific software ptype(=0) or a ptype mask(=1).</li>
<li><code class="docutils literal notranslate"><span class="pre">pkt_type</span></code>: The new software ptype to replace the old ones.</li>
</ul>
<p>Update hardware defined ptype to software defined packet type mapping table:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; ptype mapping update (port_id) (hw_ptype) (sw_ptype)
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">hw_ptype</span></code>: hardware ptype as the index of the ptype mapping table.</li>
<li><code class="docutils literal notranslate"><span class="pre">sw_ptype</span></code>: software ptype as the value of the ptype mapping table.</li>
</ul>
<p>Reset ptype mapping table:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; ptype mapping reset (port_id)
</pre></div>
</div>
</div>
</div>
<div class="section" id="port-functions">
<h2>4.6. Port Functions</h2>
<p>The following sections show functions for configuring ports.</p>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">Port configuration changes only become active when forwarding is started/restarted.</p>
</div>
<div class="section" id="port-attach">
<h3>4.6.1. port attach</h3>
<p>Attach a port specified by pci address or virtual device args:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; port attach (identifier)
</pre></div>
</div>
<p>To attach a new pci device, the device should be recognized by kernel first.
Then it should be moved under DPDK management.
Finally the port can be attached to testpmd.</p>
<p>For example, to move a pci device using ixgbe under DPDK management:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> Check the status of the available devices.
<span class="go">./usertools/dpdk-devbind.py --status</span>

<span class="go">Network devices using DPDK-compatible driver</span>
<span class="go">============================================</span>
<span class="go">&lt;none&gt;</span>

<span class="go">Network devices using kernel driver</span>
<span class="go">===================================</span>
<span class="go">0000:0a:00.0 &#39;82599ES 10-Gigabit&#39; if=eth2 drv=ixgbe unused=</span>


<span class="gp">#</span> Bind the device to igb_uio.
<span class="go">sudo ./usertools/dpdk-devbind.py -b igb_uio 0000:0a:00.0</span>


<span class="gp">#</span> Recheck the status of the devices.
<span class="go">./usertools/dpdk-devbind.py --status</span>
<span class="go">Network devices using DPDK-compatible driver</span>
<span class="go">============================================</span>
<span class="go">0000:0a:00.0 &#39;82599ES 10-Gigabit&#39; drv=igb_uio unused=</span>
</pre></div>
</div>
<p>To attach a port created by virtual device, above steps are not needed.</p>
<p>For example, to attach a port whose pci address is 0000:0a:00.0.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">testpmd&gt; port attach 0000:0a:00.0</span>
<span class="go">Attaching a new port...</span>
<span class="go">EAL: PCI device 0000:0a:00.0 on NUMA socket -1</span>
<span class="go">EAL:   probe driver: 8086:10fb rte_ixgbe_pmd</span>
<span class="go">EAL:   PCI memory mapped at 0x7f83bfa00000</span>
<span class="go">EAL:   PCI memory mapped at 0x7f83bfa80000</span>
<span class="go">PMD: eth_ixgbe_dev_init(): MAC: 2, PHY: 18, SFP+: 5</span>
<span class="go">PMD: eth_ixgbe_dev_init(): port 0 vendorID=0x8086 deviceID=0x10fb</span>
<span class="go">Port 0 is attached. Now total ports is 1</span>
<span class="go">Done</span>
</pre></div>
</div>
<p>For example, to attach a port created by pcap PMD.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">testpmd&gt; port attach net_pcap0</span>
<span class="go">Attaching a new port...</span>
<span class="go">PMD: Initializing pmd_pcap for net_pcap0</span>
<span class="go">PMD: Creating pcap-backed ethdev on numa socket 0</span>
<span class="go">Port 0 is attached. Now total ports is 1</span>
<span class="go">Done</span>
</pre></div>
</div>
<p>In this case, identifier is <code class="docutils literal notranslate"><span class="pre">net_pcap0</span></code>.
This identifier format is the same as <code class="docutils literal notranslate"><span class="pre">--vdev</span></code> format of DPDK applications.</p>
<p>For example, to re-attach a bonded port which has been previously detached,
the mode and slave parameters must be given.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">testpmd&gt; port attach net_bond_0,mode=0,slave=1</span>
<span class="go">Attaching a new port...</span>
<span class="go">EAL: Initializing pmd_bond for net_bond_0</span>
<span class="go">EAL: Create bonded device net_bond_0 on port 0 in mode 0 on socket 0.</span>
<span class="go">Port 0 is attached. Now total ports is 1</span>
<span class="go">Done</span>
</pre></div>
</div>
</div>
<div class="section" id="port-detach">
<h3>4.6.2. port detach</h3>
<p>Detach a specific port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; port detach (port_id)
</pre></div>
</div>
<p>Before detaching a port, the port should be stopped and closed.</p>
<p>For example, to detach a pci device port 0.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">testpmd&gt; port stop 0</span>
<span class="go">Stopping ports...</span>
<span class="go">Done</span>
<span class="go">testpmd&gt; port close 0</span>
<span class="go">Closing ports...</span>
<span class="go">Done</span>

<span class="go">testpmd&gt; port detach 0</span>
<span class="go">Detaching a port...</span>
<span class="go">EAL: PCI device 0000:0a:00.0 on NUMA socket -1</span>
<span class="go">EAL:   remove driver: 8086:10fb rte_ixgbe_pmd</span>
<span class="go">EAL:   PCI memory unmapped at 0x7f83bfa00000</span>
<span class="go">EAL:   PCI memory unmapped at 0x7f83bfa80000</span>
<span class="go">Done</span>
</pre></div>
</div>
<p>For example, to detach a virtual device port 0.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">testpmd&gt; port stop 0</span>
<span class="go">Stopping ports...</span>
<span class="go">Done</span>
<span class="go">testpmd&gt; port close 0</span>
<span class="go">Closing ports...</span>
<span class="go">Done</span>

<span class="go">testpmd&gt; port detach 0</span>
<span class="go">Detaching a port...</span>
<span class="go">PMD: Closing pcap ethdev on numa socket 0</span>
<span class="go">Port &#39;net_pcap0&#39; is detached. Now total ports is 0</span>
<span class="go">Done</span>
</pre></div>
</div>
<p>To remove a pci device completely from the system, first detach the port from testpmd.
Then the device should be moved under kernel management.
Finally the device can be removed using kernel pci hotplug functionality.</p>
<p>For example, to move a pci device under kernel management:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sudo ./usertools/dpdk-devbind.py -b ixgbe 0000:0a:00.0</span>

<span class="go">./usertools/dpdk-devbind.py --status</span>

<span class="go">Network devices using DPDK-compatible driver</span>
<span class="go">============================================</span>
<span class="go">&lt;none&gt;</span>

<span class="go">Network devices using kernel driver</span>
<span class="go">===================================</span>
<span class="go">0000:0a:00.0 &#39;82599ES 10-Gigabit&#39; if=eth2 drv=ixgbe unused=igb_uio</span>
</pre></div>
</div>
<p>To remove a port created by a virtual device, above steps are not needed.</p>
</div>
<div class="section" id="port-start">
<h3>4.6.3. port start</h3>
<p>Start all ports or a specific port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; port start (port_id|all)
</pre></div>
</div>
</div>
<div class="section" id="port-stop">
<h3>4.6.4. port stop</h3>
<p>Stop all ports or a specific port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; port stop (port_id|all)
</pre></div>
</div>
</div>
<div class="section" id="port-close">
<h3>4.6.5. port close</h3>
<p>Close all ports or a specific port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; port close (port_id|all)
</pre></div>
</div>
</div>
<div class="section" id="port-start-stop-queue">
<h3>4.6.6. port start/stop queue</h3>
<p>Start/stop a rx/tx queue on a specific port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; port (port_id) (rxq|txq) (queue_id) (start|stop)
</pre></div>
</div>
<p>Only take effect when port is started.</p>
</div>
<div class="section" id="port-config-speed">
<h3>4.6.7. port config - speed</h3>
<p>Set the speed and duplex mode for all ports or a specific port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; port config (port_id|all) speed (10|100|1000|10000|25000|40000|50000|100000|auto) \
         duplex (half|full|auto)
</pre></div>
</div>
</div>
<div class="section" id="port-config-queues-descriptors">
<h3>4.6.8. port config - queues/descriptors</h3>
<p>Set number of queues/descriptors for rxq, txq, rxd and txd:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; port config all (rxq|txq|rxd|txd) (value)
</pre></div>
</div>
<p>This is equivalent to the <code class="docutils literal notranslate"><span class="pre">--rxq</span></code>, <code class="docutils literal notranslate"><span class="pre">--txq</span></code>, <code class="docutils literal notranslate"><span class="pre">--rxd</span></code> and <code class="docutils literal notranslate"><span class="pre">--txd</span></code> command-line options.</p>
</div>
<div class="section" id="port-config-max-pkt-len">
<h3>4.6.9. port config - max-pkt-len</h3>
<p>Set the maximum packet length:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; port config all max-pkt-len (value)
</pre></div>
</div>
<p>This is equivalent to the <code class="docutils literal notranslate"><span class="pre">--max-pkt-len</span></code> command-line option.</p>
</div>
<div class="section" id="port-config-crc-strip">
<h3>4.6.10. port config - CRC Strip</h3>
<p>Set hardware CRC stripping on or off for all ports:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; port config all crc-strip (on|off)
</pre></div>
</div>
<p>CRC stripping is on by default.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">off</span></code> option is equivalent to the <code class="docutils literal notranslate"><span class="pre">--disable-crc-strip</span></code> command-line option.</p>
</div>
<div class="section" id="port-config-scatter">
<h3>4.6.11. port config - scatter</h3>
<p>Set RX scatter mode on or off for all ports:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; port config all scatter (on|off)
</pre></div>
</div>
<p>RX scatter mode is off by default.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">on</span></code> option is equivalent to the <code class="docutils literal notranslate"><span class="pre">--enable-scatter</span></code> command-line option.</p>
</div>
<div class="section" id="port-config-tx-queue-flags">
<h3>4.6.12. port config - TX queue flags</h3>
<p>Set a hexadecimal bitmap of TX queue flags for all ports:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; port config all txqflags value
</pre></div>
</div>
<p>This command is equivalent to the <code class="docutils literal notranslate"><span class="pre">--txqflags</span></code> command-line option.</p>
</div>
<div class="section" id="port-config-rx-checksum">
<h3>4.6.13. port config - RX Checksum</h3>
<p>Set hardware RX checksum offload to on or off for all ports:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; port config all rx-cksum (on|off)
</pre></div>
</div>
<p>Checksum offload is off by default.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">on</span></code> option is equivalent to the <code class="docutils literal notranslate"><span class="pre">--enable-rx-cksum</span></code> command-line option.</p>
</div>
<div class="section" id="port-config-vlan">
<h3>4.6.14. port config - VLAN</h3>
<p>Set hardware VLAN on or off for all ports:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; port config all hw-vlan (on|off)
</pre></div>
</div>
<p>Hardware VLAN is on by default.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">off</span></code> option is equivalent to the <code class="docutils literal notranslate"><span class="pre">--disable-hw-vlan</span></code> command-line option.</p>
</div>
<div class="section" id="port-config-vlan-filter">
<h3>4.6.15. port config - VLAN filter</h3>
<p>Set hardware VLAN filter on or off for all ports:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; port config all hw-vlan-filter (on|off)
</pre></div>
</div>
<p>Hardware VLAN filter is on by default.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">off</span></code> option is equivalent to the <code class="docutils literal notranslate"><span class="pre">--disable-hw-vlan-filter</span></code> command-line option.</p>
</div>
<div class="section" id="port-config-vlan-strip">
<h3>4.6.16. port config - VLAN strip</h3>
<p>Set hardware VLAN strip on or off for all ports:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; port config all hw-vlan-strip (on|off)
</pre></div>
</div>
<p>Hardware VLAN strip is on by default.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">off</span></code> option is equivalent to the <code class="docutils literal notranslate"><span class="pre">--disable-hw-vlan-strip</span></code> command-line option.</p>
</div>
<div class="section" id="port-config-vlan-extend">
<h3>4.6.17. port config - VLAN extend</h3>
<p>Set hardware VLAN extend on or off for all ports:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; port config all hw-vlan-extend (on|off)
</pre></div>
</div>
<p>Hardware VLAN extend is off by default.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">off</span></code> option is equivalent to the <code class="docutils literal notranslate"><span class="pre">--disable-hw-vlan-extend</span></code> command-line option.</p>
</div>
<div class="section" id="port-config-drop-packets">
<h3>4.6.18. port config - Drop Packets</h3>
<p>Set packet drop for packets with no descriptors on or off for all ports:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; port config all drop-en (on|off)
</pre></div>
</div>
<p>Packet dropping for packets with no descriptors is off by default.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">on</span></code> option is equivalent to the <code class="docutils literal notranslate"><span class="pre">--enable-drop-en</span></code> command-line option.</p>
</div>
<div class="section" id="port-config-rss">
<h3>4.6.19. port config - RSS</h3>
<p>Set the RSS (Receive Side Scaling) mode on or off:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; port config all rss (all|ip|tcp|udp|sctp|ether|port|vxlan|geneve|nvgre|none)
</pre></div>
</div>
<p>RSS is on by default.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">none</span></code> option is equivalent to the <code class="docutils literal notranslate"><span class="pre">--disable-rss</span></code> command-line option.</p>
</div>
<div class="section" id="port-config-rss-reta">
<h3>4.6.20. port config - RSS Reta</h3>
<p>Set the RSS (Receive Side Scaling) redirection table:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; port config all rss reta (hash,queue)[,(hash,queue)]
</pre></div>
</div>
</div>
<div class="section" id="port-config-dcb">
<h3>4.6.21. port config - DCB</h3>
<p>Set the DCB mode for an individual port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; port config (port_id) dcb vt (on|off) (traffic_class) pfc (on|off)
</pre></div>
</div>
<p>The traffic class should be 4 or 8.</p>
</div>
<div class="section" id="port-config-burst">
<h3>4.6.22. port config - Burst</h3>
<p>Set the number of packets per burst:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; port config all burst (value)
</pre></div>
</div>
<p>This is equivalent to the <code class="docutils literal notranslate"><span class="pre">--burst</span></code> command-line option.</p>
</div>
<div class="section" id="port-config-threshold">
<h3>4.6.23. port config - Threshold</h3>
<p>Set thresholds for TX/RX queues:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; port config all (threshold) (value)
</pre></div>
</div>
<p>Where the threshold type can be:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">txpt:</span></code> Set the prefetch threshold register of the TX rings, 0 &lt;= value &lt;= 255.</li>
<li><code class="docutils literal notranslate"><span class="pre">txht:</span></code> Set the host threshold register of the TX rings, 0 &lt;= value &lt;= 255.</li>
<li><code class="docutils literal notranslate"><span class="pre">txwt:</span></code> Set the write-back threshold register of the TX rings, 0 &lt;= value &lt;= 255.</li>
<li><code class="docutils literal notranslate"><span class="pre">rxpt:</span></code> Set the prefetch threshold register of the RX rings, 0 &lt;= value &lt;= 255.</li>
<li><code class="docutils literal notranslate"><span class="pre">rxht:</span></code> Set the host threshold register of the RX rings, 0 &lt;= value &lt;= 255.</li>
<li><code class="docutils literal notranslate"><span class="pre">rxwt:</span></code> Set the write-back threshold register of the RX rings, 0 &lt;= value &lt;= 255.</li>
<li><code class="docutils literal notranslate"><span class="pre">txfreet:</span></code> Set the transmit free threshold of the TX rings, 0 &lt;= value &lt;= txd.</li>
<li><code class="docutils literal notranslate"><span class="pre">rxfreet:</span></code> Set the transmit free threshold of the RX rings, 0 &lt;= value &lt;= rxd.</li>
<li><code class="docutils literal notranslate"><span class="pre">txrst:</span></code> Set the transmit RS bit threshold of TX rings, 0 &lt;= value &lt;= txd.</li>
</ul>
<p>These threshold options are also available from the command-line.</p>
</div>
<div class="section" id="port-config-e-tag">
<h3>4.6.24. port config - E-tag</h3>
<p>Set the value of ether-type for E-tag:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; port config (port_id|all) l2-tunnel E-tag ether-type (value)
</pre></div>
</div>
<p>Enable/disable the E-tag support:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; port config (port_id|all) l2-tunnel E-tag (enable|disable)
</pre></div>
</div>
</div>
</div>
<div class="section" id="link-bonding-functions">
<h2>4.7. Link Bonding Functions</h2>
<p>The Link Bonding functions make it possible to dynamically create and
manage link bonding devices from within testpmd interactive prompt.</p>
<div class="section" id="create-bonded-device">
<h3>4.7.1. create bonded device</h3>
<p>Create a new bonding device:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; create bonded device (mode) (socket)
</pre></div>
</div>
<p>For example, to create a bonded device in mode 1 on socket 0:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; create bonded 1 0
created new bonded device (port X)
</pre></div>
</div>
</div>
<div class="section" id="add-bonding-slave">
<h3>4.7.2. add bonding slave</h3>
<p>Adds Ethernet device to a Link Bonding device:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; add bonding slave (slave id) (port id)
</pre></div>
</div>
<p>For example, to add Ethernet device (port 6) to a Link Bonding device (port 10):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; add bonding slave 6 10
</pre></div>
</div>
</div>
<div class="section" id="remove-bonding-slave">
<h3>4.7.3. remove bonding slave</h3>
<p>Removes an Ethernet slave device from a Link Bonding device:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; remove bonding slave (slave id) (port id)
</pre></div>
</div>
<p>For example, to remove Ethernet slave device (port 6) to a Link Bonding device (port 10):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; remove bonding slave 6 10
</pre></div>
</div>
</div>
<div class="section" id="set-bonding-mode">
<h3>4.7.4. set bonding mode</h3>
<p>Set the Link Bonding mode of a Link Bonding device:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set bonding mode (value) (port id)
</pre></div>
</div>
<p>For example, to set the bonding mode of a Link Bonding device (port 10) to broadcast (mode 3):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set bonding mode 3 10
</pre></div>
</div>
</div>
<div class="section" id="set-bonding-primary">
<h3>4.7.5. set bonding primary</h3>
<p>Set an Ethernet slave device as the primary device on a Link Bonding device:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set bonding primary (slave id) (port id)
</pre></div>
</div>
<p>For example, to set the Ethernet slave device (port 6) as the primary port of a Link Bonding device (port 10):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set bonding primary 6 10
</pre></div>
</div>
</div>
<div class="section" id="set-bonding-mac">
<h3>4.7.6. set bonding mac</h3>
<p>Set the MAC address of a Link Bonding device:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set bonding mac (port id) (mac)
</pre></div>
</div>
<p>For example, to set the MAC address of a Link Bonding device (port 10) to 00:00:00:00:00:01:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set bonding mac 10 00:00:00:00:00:01
</pre></div>
</div>
</div>
<div class="section" id="set-bonding-xmit-balance-policy">
<h3>4.7.7. set bonding xmit_balance_policy</h3>
<p>Set the transmission policy for a Link Bonding device when it is in Balance XOR mode:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set bonding xmit_balance_policy (port_id) (l2|l23|l34)
</pre></div>
</div>
<p>For example, set a Link Bonding device (port 10) to use a balance policy of layer 3+4 (IP addresses &amp; UDP ports):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set bonding xmit_balance_policy 10 l34
</pre></div>
</div>
</div>
<div class="section" id="set-bonding-mon-period">
<h3>4.7.8. set bonding mon_period</h3>
<p>Set the link status monitoring polling period in milliseconds for a bonding device.</p>
<p>This adds support for PMD slave devices which do not support link status interrupts.
When the mon_period is set to a value greater than 0 then all PMD's which do not support
link status ISR will be queried every polling interval to check if their link status has changed:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set bonding mon_period (port_id) (value)
</pre></div>
</div>
<p>For example, to set the link status monitoring polling period of bonded device (port 5) to 150ms:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set bonding mon_period 5 150
</pre></div>
</div>
</div>
<div class="section" id="show-bonding-config">
<h3>4.7.9. show bonding config</h3>
<p>Show the current configuration of a Link Bonding device:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; show bonding config (port id)
</pre></div>
</div>
<p>For example,
to show the configuration a Link Bonding device (port 9) with 3 slave devices (1, 3, 4)
in balance mode with a transmission policy of layer 2+3:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; show bonding config 9
     Bonding mode: 2
     Balance Xmit Policy: BALANCE_XMIT_POLICY_LAYER23
     Slaves (3): [1 3 4]
     Active Slaves (3): [1 3 4]
     Primary: [3]
</pre></div>
</div>
</div>
</div>
<div class="section" id="register-functions">
<h2>4.8. Register Functions</h2>
<p>The Register Functions can be used to read from and write to registers on the network card referenced by a port number.
This is mainly useful for debugging purposes.
Reference should be made to the appropriate datasheet for the network card for details on the register addresses
and fields that can be accessed.</p>
<div class="section" id="read-reg">
<h3>4.8.1. read reg</h3>
<p>Display the value of a port register:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; read reg (port_id) (address)
</pre></div>
</div>
<p>For example, to examine the Flow Director control register (FDIRCTL, 0x0000EE000) on an Intel 82599 10 GbE Controller:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; read reg 0 0xEE00
port 0 PCI register at offset 0xEE00: 0x4A060029 (1241907241)
</pre></div>
</div>
</div>
<div class="section" id="read-regfield">
<h3>4.8.2. read regfield</h3>
<p>Display a port register bit field:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; read regfield (port_id) (address) (bit_x) (bit_y)
</pre></div>
</div>
<p>For example, reading the lowest two bits from the register in the example above:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; read regfield 0 0xEE00 0 1
port 0 PCI register at offset 0xEE00: bits[0, 1]=0x1 (1)
</pre></div>
</div>
</div>
<div class="section" id="read-regbit">
<h3>4.8.3. read regbit</h3>
<p>Display a single port register bit:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; read regbit (port_id) (address) (bit_x)
</pre></div>
</div>
<p>For example, reading the lowest bit from the register in the example above:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; read regbit 0 0xEE00 0
port 0 PCI register at offset 0xEE00: bit 0=1
</pre></div>
</div>
</div>
<div class="section" id="write-reg">
<h3>4.8.4. write reg</h3>
<p>Set the value of a port register:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; write reg (port_id) (address) (value)
</pre></div>
</div>
<p>For example, to clear a register:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; write reg 0 0xEE00 0x0
port 0 PCI register at offset 0xEE00: 0x00000000 (0)
</pre></div>
</div>
</div>
<div class="section" id="write-regfield">
<h3>4.8.5. write regfield</h3>
<p>Set bit field of a port register:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; write regfield (port_id) (address) (bit_x) (bit_y) (value)
</pre></div>
</div>
<p>For example, writing to the register cleared in the example above:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; write regfield 0 0xEE00 0 1 2
port 0 PCI register at offset 0xEE00: 0x00000002 (2)
</pre></div>
</div>
</div>
<div class="section" id="write-regbit">
<h3>4.8.6. write regbit</h3>
<p>Set single bit value of a port register:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; write regbit (port_id) (address) (bit_x) (value)
</pre></div>
</div>
<p>For example, to set the high bit in the register from the example above:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; write regbit 0 0xEE00 31 1
port 0 PCI register at offset 0xEE00: 0x8000000A (2147483658)
</pre></div>
</div>
</div>
</div>
<div class="section" id="filter-functions">
<h2>4.9. Filter Functions</h2>
<p>This section details the available filter functions that are available.</p>
<p>Note these functions interface the deprecated legacy filtering framework,
superseded by <em>rte_flow</em>. See <a class="reference internal" href="#flow-rules-management">Flow rules management</a>.</p>
<div class="section" id="ethertype-filter">
<h3>4.9.1. ethertype_filter</h3>
<p>Add or delete a L2 Ethertype filter, which identify packets by their L2 Ethertype mainly assign them to a receive queue:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ethertype_filter (port_id) (add|del) (mac_addr|mac_ignr) (mac_address) \
                 ethertype (ether_type) (drop|fwd) queue (queue_id)
</pre></div>
</div>
<p>The available information parameters are:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">port_id</span></code>: The port which the Ethertype filter assigned on.</li>
<li><code class="docutils literal notranslate"><span class="pre">mac_addr</span></code>: Compare destination mac address.</li>
<li><code class="docutils literal notranslate"><span class="pre">mac_ignr</span></code>: Ignore destination mac address match.</li>
<li><code class="docutils literal notranslate"><span class="pre">mac_address</span></code>: Destination mac address to match.</li>
<li><code class="docutils literal notranslate"><span class="pre">ether_type</span></code>: The EtherType value want to match,
for example 0x0806 for ARP packet. 0x0800 (IPv4) and 0x86DD (IPv6) are invalid.</li>
<li><code class="docutils literal notranslate"><span class="pre">queue_id</span></code>: The receive queue associated with this EtherType filter.
It is meaningless when deleting or dropping.</li>
</ul>
<p>Example, to add/remove an ethertype filter rule:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; ethertype_filter 0 add mac_ignr 00:11:22:33:44:55 \
                          ethertype 0x0806 fwd queue 3

testpmd&gt; ethertype_filter 0 del mac_ignr 00:11:22:33:44:55 \
                          ethertype 0x0806 fwd queue 3
</pre></div>
</div>
</div>
<div class="section" id="tuple-filter">
<h3>4.9.2. 2tuple_filter</h3>
<p>Add or delete a 2-tuple filter,
which identifies packets by specific protocol and destination TCP/UDP port
and forwards packets into one of the receive queues:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>2tuple_filter (port_id) (add|del) dst_port (dst_port_value) \
              protocol (protocol_value) mask (mask_value) \
              tcp_flags (tcp_flags_value) priority (prio_value) \
              queue (queue_id)
</pre></div>
</div>
<p>The available information parameters are:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">port_id</span></code>: The port which the 2-tuple filter assigned on.</li>
<li><code class="docutils literal notranslate"><span class="pre">dst_port_value</span></code>: Destination port in L4.</li>
<li><code class="docutils literal notranslate"><span class="pre">protocol_value</span></code>: IP L4 protocol.</li>
<li><code class="docutils literal notranslate"><span class="pre">mask_value</span></code>: Participates in the match or not by bit for field above, 1b means participate.</li>
<li><code class="docutils literal notranslate"><span class="pre">tcp_flags_value</span></code>: TCP control bits. The non-zero value is invalid, when the pro_value is not set to 0x06 (TCP).</li>
<li><code class="docutils literal notranslate"><span class="pre">prio_value</span></code>: Priority of this filter.</li>
<li><code class="docutils literal notranslate"><span class="pre">queue_id</span></code>: The receive queue associated with this 2-tuple filter.</li>
</ul>
<p>Example, to add/remove an 2tuple filter rule:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; 2tuple_filter 0 add dst_port 32 protocol 0x06 mask 0x03 \
                       tcp_flags 0x02 priority 3 queue 3

testpmd&gt; 2tuple_filter 0 del dst_port 32 protocol 0x06 mask 0x03 \
                       tcp_flags 0x02 priority 3 queue 3
</pre></div>
</div>
</div>
<div class="section" id="id1">
<h3>4.9.3. 5tuple_filter</h3>
<p>Add or delete a 5-tuple filter,
which consists of a 5-tuple (protocol, source and destination IP addresses, source and destination TCP/UDP/SCTP port)
and routes packets into one of the receive queues:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>5tuple_filter (port_id) (add|del) dst_ip (dst_address) src_ip \
              (src_address) dst_port (dst_port_value) \
              src_port (src_port_value) protocol (protocol_value) \
              mask (mask_value) tcp_flags (tcp_flags_value) \
              priority (prio_value) queue (queue_id)
</pre></div>
</div>
<p>The available information parameters are:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">port_id</span></code>: The port which the 5-tuple filter assigned on.</li>
<li><code class="docutils literal notranslate"><span class="pre">dst_address</span></code>: Destination IP address.</li>
<li><code class="docutils literal notranslate"><span class="pre">src_address</span></code>: Source IP address.</li>
<li><code class="docutils literal notranslate"><span class="pre">dst_port_value</span></code>: TCP/UDP destination port.</li>
<li><code class="docutils literal notranslate"><span class="pre">src_port_value</span></code>: TCP/UDP source port.</li>
<li><code class="docutils literal notranslate"><span class="pre">protocol_value</span></code>: L4 protocol.</li>
<li><code class="docutils literal notranslate"><span class="pre">mask_value</span></code>: Participates in the match or not by bit for field above, 1b means participate</li>
<li><code class="docutils literal notranslate"><span class="pre">tcp_flags_value</span></code>: TCP control bits. The non-zero value is invalid, when the protocol_value is not set to 0x06 (TCP).</li>
<li><code class="docutils literal notranslate"><span class="pre">prio_value</span></code>: The priority of this filter.</li>
<li><code class="docutils literal notranslate"><span class="pre">queue_id</span></code>: The receive queue associated with this 5-tuple filter.</li>
</ul>
<p>Example, to add/remove an 5tuple filter rule:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; 5tuple_filter 0 add dst_ip 2.2.2.5 src_ip 2.2.2.4 \
         dst_port 64 src_port 32 protocol 0x06 mask 0x1F \
         flags 0x0 priority 3 queue 3

testpmd&gt; 5tuple_filter 0 del dst_ip 2.2.2.5 src_ip 2.2.2.4 \
         dst_port 64 src_port 32 protocol 0x06 mask 0x1F \
         flags 0x0 priority 3 queue 3
</pre></div>
</div>
</div>
<div class="section" id="syn-filter">
<h3>4.9.4. syn_filter</h3>
<p>Using the  SYN filter, TCP packets whose <em>SYN</em> flag is set can be forwarded to a separate queue:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>syn_filter (port_id) (add|del) priority (high|low) queue (queue_id)
</pre></div>
</div>
<p>The available information parameters are:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">port_id</span></code>: The port which the SYN filter assigned on.</li>
<li><code class="docutils literal notranslate"><span class="pre">high</span></code>: This SYN filter has higher priority than other filters.</li>
<li><code class="docutils literal notranslate"><span class="pre">low</span></code>: This SYN filter has lower priority than other filters.</li>
<li><code class="docutils literal notranslate"><span class="pre">queue_id</span></code>: The receive queue associated with this SYN filter</li>
</ul>
<p>Example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; syn_filter 0 add priority high queue 3
</pre></div>
</div>
</div>
<div class="section" id="flex-filter">
<h3>4.9.5. flex_filter</h3>
<p>With flex filter, packets can be recognized by any arbitrary pattern within the first 128 bytes of the packet
and routed into one of the receive queues:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flex_filter (port_id) (add|del) len (len_value) bytes (bytes_value) \
            mask (mask_value) priority (prio_value) queue (queue_id)
</pre></div>
</div>
<p>The available information parameters are:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">port_id</span></code>: The port which the Flex filter is assigned on.</li>
<li><code class="docutils literal notranslate"><span class="pre">len_value</span></code>: Filter length in bytes, no greater than 128.</li>
<li><code class="docutils literal notranslate"><span class="pre">bytes_value</span></code>: A string in hexadecimal, means the value the flex filter needs to match.</li>
<li><code class="docutils literal notranslate"><span class="pre">mask_value</span></code>: A string in hexadecimal, bit 1 means corresponding byte participates in the match.</li>
<li><code class="docutils literal notranslate"><span class="pre">prio_value</span></code>: The priority of this filter.</li>
<li><code class="docutils literal notranslate"><span class="pre">queue_id</span></code>: The receive queue associated with this Flex filter.</li>
</ul>
<p>Example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flex_filter 0 add len 16 bytes 0x00000000000000000000000008060000 \
                       mask 000C priority 3 queue 3

testpmd&gt; flex_filter 0 del len 16 bytes 0x00000000000000000000000008060000 \
                       mask 000C priority 3 queue 3
</pre></div>
</div>
</div>
<div class="section" id="flow-director-filter">
<span id="testpmd-flow-director"></span><h3>4.9.6. flow_director_filter</h3>
<p>The Flow Director works in receive mode to identify specific flows or sets of flows and route them to specific queues.</p>
<p>Four types of filtering are supported which are referred to as Perfect Match, Signature, Perfect-mac-vlan and
Perfect-tunnel filters, the match mode is set by the <code class="docutils literal notranslate"><span class="pre">--pkt-filter-mode</span></code> command-line parameter:</p>
<ul class="simple">
<li>Perfect match filters.
The hardware checks a match between the masked fields of the received packets and the programmed filters.
The masked fields are for IP flow.</li>
<li>Signature filters.
The hardware checks a match between a hash-based signature of the masked fields of the received packet.</li>
<li>Perfect-mac-vlan match filters.
The hardware checks a match between the masked fields of the received packets and the programmed filters.
The masked fields are for MAC VLAN flow.</li>
<li>Perfect-tunnel match filters.
The hardware checks a match between the masked fields of the received packets and the programmed filters.
The masked fields are for tunnel flow.</li>
</ul>
<p>The Flow Director filters can match the different fields for different type of packet: flow type, specific input set
per flow type and the flexible payload.</p>
<p>The Flow Director can also mask out parts of all of these fields so that filters
are only applied to certain fields or parts of the fields.</p>
<p>Different NICs may have different capabilities, command show port fdir (port_id) can be used to acquire the information.</p>
<p># Commands to add flow director filters of different flow types:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow_director_filter (port_id) mode IP (add|del|update) \
                     flow (ipv4-other|ipv4-frag|ipv6-other|ipv6-frag) \
                     src (src_ip_address) dst (dst_ip_address) \
                     tos (tos_value) proto (proto_value) ttl (ttl_value) \
                     vlan (vlan_value) flexbytes (flexbytes_value) \
                     (drop|fwd) pf|vf(vf_id) queue (queue_id) \
                     fd_id (fd_id_value)

flow_director_filter (port_id) mode IP (add|del|update) \
                     flow (ipv4-tcp|ipv4-udp|ipv6-tcp|ipv6-udp) \
                     src (src_ip_address) (src_port) \
                     dst (dst_ip_address) (dst_port) \
                     tos (tos_value) ttl (ttl_value) \
                     vlan (vlan_value) flexbytes (flexbytes_value) \
                     (drop|fwd) queue pf|vf(vf_id) (queue_id) \
                     fd_id (fd_id_value)

flow_director_filter (port_id) mode IP (add|del|update) \
                     flow (ipv4-sctp|ipv6-sctp) \
                     src (src_ip_address) (src_port) \
                     dst (dst_ip_address) (dst_port) \
                     tos (tos_value) ttl (ttl_value) \
                     tag (verification_tag) vlan (vlan_value) \
                     flexbytes (flexbytes_value) (drop|fwd) \
                     pf|vf(vf_id) queue (queue_id) fd_id (fd_id_value)

flow_director_filter (port_id) mode IP (add|del|update) flow l2_payload \
                     ether (ethertype) flexbytes (flexbytes_value) \
                     (drop|fwd) pf|vf(vf_id) queue (queue_id)
                     fd_id (fd_id_value)

flow_director_filter (port_id) mode MAC-VLAN (add|del|update) \
                     mac (mac_address) vlan (vlan_value) \
                     flexbytes (flexbytes_value) (drop|fwd) \
                     queue (queue_id) fd_id (fd_id_value)

flow_director_filter (port_id) mode Tunnel (add|del|update) \
                     mac (mac_address) vlan (vlan_value) \
                     tunnel (NVGRE|VxLAN) tunnel-id (tunnel_id_value) \
                     flexbytes (flexbytes_value) (drop|fwd) \
                     queue (queue_id) fd_id (fd_id_value)
</pre></div>
</div>
<p>For example, to add an ipv4-udp flow type filter:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow_director_filter 0 mode IP add flow ipv4-udp src 2.2.2.3 32 \
         dst 2.2.2.5 33 tos 2 ttl 40 vlan 0x1 flexbytes (0x88,0x48) \
         fwd pf queue 1 fd_id 1
</pre></div>
</div>
<p>For example, add an ipv4-other flow type filter:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow_director_filter 0 mode IP add flow ipv4-other src 2.2.2.3 \
          dst 2.2.2.5 tos 2 proto 20 ttl 40 vlan 0x1 \
          flexbytes (0x88,0x48) fwd pf queue 1 fd_id 1
</pre></div>
</div>
</div>
<div class="section" id="flush-flow-director">
<h3>4.9.7. flush_flow_director</h3>
<p>Flush all flow director filters on a device:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flush_flow_director (port_id)
</pre></div>
</div>
<p>Example, to flush all flow director filter on port 0:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flush_flow_director 0
</pre></div>
</div>
</div>
<div class="section" id="flow-director-mask">
<h3>4.9.8. flow_director_mask</h3>
<p>Set flow director's input masks:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow_director_mask (port_id) mode IP vlan (vlan_value) \
                   src_mask (ipv4_src) (ipv6_src) (src_port) \
                   dst_mask (ipv4_dst) (ipv6_dst) (dst_port)

flow_director_mask (port_id) mode MAC-VLAN vlan (vlan_value)

flow_director_mask (port_id) mode Tunnel vlan (vlan_value) \
                   mac (mac_value) tunnel-type (tunnel_type_value) \
                   tunnel-id (tunnel_id_value)
</pre></div>
</div>
<p>Example, to set flow director mask on port 0:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow_director_mask 0 mode IP vlan 0xefff \
         src_mask 255.255.255.255 \
             FFFF:FFFF:FFFF:FFFF:FFFF:FFFF:FFFF:FFFF 0xFFFF \
         dst_mask 255.255.255.255 \
             FFFF:FFFF:FFFF:FFFF:FFFF:FFFF:FFFF:FFFF 0xFFFF
</pre></div>
</div>
</div>
<div class="section" id="flow-director-flex-mask">
<h3>4.9.9. flow_director_flex_mask</h3>
<p>set masks of flow director's flexible payload based on certain flow type:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow_director_flex_mask (port_id) \
         flow (none|ipv4-other|ipv4-frag|ipv4-tcp|ipv4-udp|ipv4-sctp| \
               ipv6-other|ipv6-frag|ipv6-tcp|ipv6-udp|ipv6-sctp| \
               l2_payload|all) (mask)
</pre></div>
</div>
<p>Example, to set flow director's flex mask for all flow type on port 0:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow_director_flex_mask 0 flow all \
         (0xff,0xff,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
</pre></div>
</div>
</div>
<div class="section" id="flow-director-flex-payload">
<h3>4.9.10. flow_director_flex_payload</h3>
<p>Configure flexible payload selection:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow_director_flex_payload (port_id) (raw|l2|l3|l4) (config)
</pre></div>
</div>
<p>For example, to select the first 16 bytes from the offset 4 (bytes) of packet's payload as flexible payload:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow_director_flex_payload 0 l4 \
         (4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19)
</pre></div>
</div>
</div>
<div class="section" id="get-sym-hash-ena-per-port">
<h3>4.9.11. get_sym_hash_ena_per_port</h3>
<p>Get symmetric hash enable configuration per port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>get_sym_hash_ena_per_port (port_id)
</pre></div>
</div>
<p>For example, to get symmetric hash enable configuration of port 1:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; get_sym_hash_ena_per_port 1
</pre></div>
</div>
</div>
<div class="section" id="set-sym-hash-ena-per-port">
<h3>4.9.12. set_sym_hash_ena_per_port</h3>
<p>Set symmetric hash enable configuration per port to enable or disable:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set_sym_hash_ena_per_port (port_id) (enable|disable)
</pre></div>
</div>
<p>For example, to set symmetric hash enable configuration of port 1 to enable:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set_sym_hash_ena_per_port 1 enable
</pre></div>
</div>
</div>
<div class="section" id="get-hash-global-config">
<h3>4.9.13. get_hash_global_config</h3>
<p>Get the global configurations of hash filters:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>get_hash_global_config (port_id)
</pre></div>
</div>
<p>For example, to get the global configurations of hash filters of port 1:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; get_hash_global_config 1
</pre></div>
</div>
</div>
<div class="section" id="set-hash-global-config">
<h3>4.9.14. set_hash_global_config</h3>
<p>Set the global configurations of hash filters:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set_hash_global_config (port_id) (toeplitz|simple_xor|default) \
(ipv4|ipv4-frag|ipv4-tcp|ipv4-udp|ipv4-sctp|ipv4-other|ipv6|ipv6-frag| \
ipv6-tcp|ipv6-udp|ipv6-sctp|ipv6-other|l2_payload) \
(enable|disable)
</pre></div>
</div>
<p>For example, to enable simple_xor for flow type of ipv6 on port 2:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set_hash_global_config 2 simple_xor ipv6 enable
</pre></div>
</div>
</div>
<div class="section" id="set-hash-input-set">
<h3>4.9.15. set_hash_input_set</h3>
<p>Set the input set for hash:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set_hash_input_set (port_id) (ipv4-frag|ipv4-tcp|ipv4-udp|ipv4-sctp| \
ipv4-other|ipv6-frag|ipv6-tcp|ipv6-udp|ipv6-sctp|ipv6-other| \
l2_payload) (ovlan|ivlan|src-ipv4|dst-ipv4|src-ipv6|dst-ipv6|ipv4-tos| \
ipv4-proto|ipv6-tc|ipv6-next-header|udp-src-port|udp-dst-port| \
tcp-src-port|tcp-dst-port|sctp-src-port|sctp-dst-port|sctp-veri-tag| \
udp-key|gre-key|fld-1st|fld-2nd|fld-3rd|fld-4th|fld-5th|fld-6th|fld-7th| \
fld-8th|none) (select|add)
</pre></div>
</div>
<p>For example, to add source IP to hash input set for flow type of ipv4-udp on port 0:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set_hash_input_set 0 ipv4-udp src-ipv4 add
</pre></div>
</div>
</div>
<div class="section" id="set-fdir-input-set">
<h3>4.9.16. set_fdir_input_set</h3>
<p>The Flow Director filters can match the different fields for different type of packet, i.e. specific input set
on per flow type and the flexible payload. This command can be used to change input set for each flow type.</p>
<p>Set the input set for flow director:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set_fdir_input_set (port_id) (ipv4-frag|ipv4-tcp|ipv4-udp|ipv4-sctp| \
ipv4-other|ipv6|ipv6-frag|ipv6-tcp|ipv6-udp|ipv6-sctp|ipv6-other| \
l2_payload) (ivlan|ethertype|src-ipv4|dst-ipv4|src-ipv6|dst-ipv6|ipv4-tos| \
ipv4-proto|ipv4-ttl|ipv6-tc|ipv6-next-header|ipv6-hop-limits| \
tudp-src-port|udp-dst-port|cp-src-port|tcp-dst-port|sctp-src-port| \
sctp-dst-port|sctp-veri-tag|none) (select|add)
</pre></div>
</div>
<p>For example to add source IP to FD input set for flow type of ipv4-udp on port 0:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; set_fdir_input_set 0 ipv4-udp src-ipv4 add
</pre></div>
</div>
</div>
<div class="section" id="global-config">
<h3>4.9.17. global_config</h3>
<p>Set different GRE key length for input set:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>global_config (port_id) gre-key-len (number in bytes)
</pre></div>
</div>
<p>For example to set GRE key length for input set to 4 bytes on port 0:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; global_config 0 gre-key-len 4
</pre></div>
</div>
</div>
</div>
<div class="section" id="flow-rules-management">
<span id="testpmd-rte-flow"></span><h2>4.10. Flow rules management</h2>
<p>Control of the generic flow API (<em>rte_flow</em>) is fully exposed through the
<code class="docutils literal notranslate"><span class="pre">flow</span></code> command (validation, creation, destruction and queries).</p>
<p>Considering <em>rte_flow</em> overlaps with all <a class="reference internal" href="#filter-functions">Filter Functions</a>, using both
features simultaneously may cause undefined side-effects and is therefore
not recommended.</p>
<div class="section" id="flow-syntax">
<h3>4.10.1. <code class="docutils literal notranslate"><span class="pre">flow</span></code> syntax</h3>
<p>Because the <code class="docutils literal notranslate"><span class="pre">flow</span></code> command uses dynamic tokens to handle the large number
of possible flow rules combinations, its behavior differs slightly from
other commands, in particular:</p>
<ul class="simple">
<li>Pressing <em>?</em> or the <em>&lt;tab&gt;</em> key displays contextual help for the current
token, not that of the entire command.</li>
<li>Optional and repeated parameters are supported (provided they are listed
in the contextual help).</li>
</ul>
<p>The first parameter stands for the operation mode. Possible operations and
their general syntax are described below. They are covered in detail in the
following sections.</p>
<ul>
<li><p class="first">Check whether a flow rule can be created:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow validate {port_id}
    [group {group_id}] [priority {level}] [ingress] [egress]
    pattern {item} [/ {item} [...]] / end
    actions {action} [/ {action} [...]] / end
</pre></div>
</div>
</li>
<li><p class="first">Create a flow rule:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow create {port_id}
    [group {group_id}] [priority {level}] [ingress] [egress]
    pattern {item} [/ {item} [...]] / end
    actions {action} [/ {action} [...]] / end
</pre></div>
</div>
</li>
<li><p class="first">Destroy specific flow rules:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow destroy {port_id} rule {rule_id} [...]
</pre></div>
</div>
</li>
<li><p class="first">Destroy all flow rules:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow flush {port_id}
</pre></div>
</div>
</li>
<li><p class="first">Query an existing flow rule:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow query {port_id} {rule_id} {action}
</pre></div>
</div>
</li>
<li><p class="first">List existing flow rules sorted by priority, filtered by group
identifiers:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow list {port_id} [group {group_id}] [...]
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="validating-flow-rules">
<h3>4.10.2. Validating flow rules</h3>
<p><code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">validate</span></code> reports whether a flow rule would be accepted by the
underlying device in its current state but stops short of creating it. It is
bound to <code class="docutils literal notranslate"><span class="pre">rte_flow_validate()</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow validate {port_id}
   [group {group_id}] [priority {level}] [ingress] [egress]
   pattern {item} [/ {item} [...]] / end
   actions {action} [/ {action} [...]] / end
</pre></div>
</div>
<p>If successful, it will show:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Flow rule validated
</pre></div>
</div>
<p>Otherwise it will show an error message of the form:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Caught error type [...] ([...]): [...]
</pre></div>
</div>
<p>This command uses the same parameters as <code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">create</span></code>, their format is
described in <a class="reference internal" href="#creating-flow-rules">Creating flow rules</a>.</p>
<p>Check whether redirecting any Ethernet packet received on port 0 to RX queue
index 6 is supported:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow validate 0 ingress pattern eth / end
   actions queue index 6 / end
Flow rule validated
testpmd&gt;
</pre></div>
</div>
<p>Port 0 does not support TCPv6 rules:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow validate 0 ingress pattern eth / ipv6 / tcp / end
   actions drop / end
Caught error type 9 (specific pattern item): Invalid argument
testpmd&gt;
</pre></div>
</div>
</div>
<div class="section" id="creating-flow-rules">
<h3>4.10.3. Creating flow rules</h3>
<p><code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">create</span></code> validates and creates the specified flow rule. It is bound
to <code class="docutils literal notranslate"><span class="pre">rte_flow_create()</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow create {port_id}
   [group {group_id}] [priority {level}] [ingress] [egress]
   pattern {item} [/ {item} [...]] / end
   actions {action} [/ {action} [...]] / end
</pre></div>
</div>
<p>If successful, it will return a flow rule ID usable with other commands:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Flow rule #[...] created
</pre></div>
</div>
<p>Otherwise it will show an error message of the form:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Caught error type [...] ([...]): [...]
</pre></div>
</div>
<p>Parameters describe in the following order:</p>
<ul class="simple">
<li>Attributes (<em>group</em>, <em>priority</em>, <em>ingress</em>, <em>egress</em> tokens).</li>
<li>A matching pattern, starting with the <em>pattern</em> token and terminated by an
<em>end</em> pattern item.</li>
<li>Actions, starting with the <em>actions</em> token and terminated by an <em>end</em>
action.</li>
</ul>
<p>These translate directly to <em>rte_flow</em> objects provided as-is to the
underlying functions.</p>
<p>The shortest valid definition only comprises mandatory tokens:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow create 0 pattern end actions end
</pre></div>
</div>
<p>Note that PMDs may refuse rules that essentially do nothing such as this
one.</p>
<p><strong>All unspecified object values are automatically initialized to 0.</strong></p>
<div class="section" id="attributes">
<h4>4.10.3.1. Attributes</h4>
<p>These tokens affect flow rule attributes (<code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">rte_flow_attr</span></code>) and are
specified before the <code class="docutils literal notranslate"><span class="pre">pattern</span></code> token.</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">group</span> <span class="pre">{group</span> <span class="pre">id}</span></code>: priority group.</li>
<li><code class="docutils literal notranslate"><span class="pre">priority</span> <span class="pre">{level}</span></code>: priority level within group.</li>
<li><code class="docutils literal notranslate"><span class="pre">ingress</span></code>: rule applies to ingress traffic.</li>
<li><code class="docutils literal notranslate"><span class="pre">egress</span></code>: rule applies to egress traffic.</li>
</ul>
<p>Each instance of an attribute specified several times overrides the previous
value as shown below (group 4 is used):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow create 0 group 42 group 24 group 4 [...]
</pre></div>
</div>
<p>Note that once enabled, <code class="docutils literal notranslate"><span class="pre">ingress</span></code> and <code class="docutils literal notranslate"><span class="pre">egress</span></code> cannot be disabled.</p>
<p>While not specifying a direction is an error, some rules may allow both
simultaneously.</p>
<p>Most rules affect RX therefore contain the <code class="docutils literal notranslate"><span class="pre">ingress</span></code> token:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow create 0 ingress pattern [...]
</pre></div>
</div>
</div>
<div class="section" id="matching-pattern">
<h4>4.10.3.2. Matching pattern</h4>
<p>A matching pattern starts after the <code class="docutils literal notranslate"><span class="pre">pattern</span></code> token. It is made of pattern
items and is terminated by a mandatory <code class="docutils literal notranslate"><span class="pre">end</span></code> item.</p>
<p>Items are named after their type (<em>RTE_FLOW_ITEM_TYPE_</em> from <code class="docutils literal notranslate"><span class="pre">enum</span>
<span class="pre">rte_flow_item_type</span></code>).</p>
<p>The <code class="docutils literal notranslate"><span class="pre">/</span></code> token is used as a separator between pattern items as shown
below:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow create 0 ingress pattern eth / ipv4 / udp / end [...]
</pre></div>
</div>
<p>Note that protocol items like these must be stacked from lowest to highest
layer to make sense. For instance, the following rule is either invalid or
unlikely to match any packet:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow create 0 ingress pattern eth / udp / ipv4 / end [...]
</pre></div>
</div>
<p>More information on these restrictions can be found in the <em>rte_flow</em>
documentation.</p>
<p>Several items support additional specification structures, for example
<code class="docutils literal notranslate"><span class="pre">ipv4</span></code> allows specifying source and destination addresses as follows:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow create 0 ingress pattern eth / ipv4 src is 10.1.1.1
   dst is 10.2.0.0 / end [...]
</pre></div>
</div>
<p>This rule matches all IPv4 traffic with the specified properties.</p>
<p>In this example, <code class="docutils literal notranslate"><span class="pre">src</span></code> and <code class="docutils literal notranslate"><span class="pre">dst</span></code> are field names of the underlying
<code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">rte_flow_item_ipv4</span></code> object. All item properties can be specified
in a similar fashion.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">is</span></code> token means that the subsequent value must be matched exactly,
and assigns <code class="docutils literal notranslate"><span class="pre">spec</span></code> and <code class="docutils literal notranslate"><span class="pre">mask</span></code> fields in <code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">rte_flow_item</span></code>
accordingly. Possible assignment tokens are:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">is</span></code>: match value perfectly (with full bit-mask).</li>
<li><code class="docutils literal notranslate"><span class="pre">spec</span></code>: match value according to configured bit-mask.</li>
<li><code class="docutils literal notranslate"><span class="pre">last</span></code>: specify upper bound to establish a range.</li>
<li><code class="docutils literal notranslate"><span class="pre">mask</span></code>: specify bit-mask with relevant bits set to one.</li>
<li><code class="docutils literal notranslate"><span class="pre">prefix</span></code>: generate bit-mask from a prefix length.</li>
</ul>
<p>These yield identical results:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ipv4 src is 10.1.1.1
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ipv4 src spec 10.1.1.1 src mask 255.255.255.255
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ipv4 src spec 10.1.1.1 src prefix 32
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ipv4 src is 10.1.1.1 src last 10.1.1.1 # range with a single value
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ipv4 src is 10.1.1.1 src last 0 # 0 disables range
</pre></div>
</div>
<p>Inclusive ranges can be defined with <code class="docutils literal notranslate"><span class="pre">last</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ipv4 src is 10.1.1.1 src last 10.2.3.4 # 10.1.1.1 to 10.2.3.4
</pre></div>
</div>
<p>Note that <code class="docutils literal notranslate"><span class="pre">mask</span></code> affects both <code class="docutils literal notranslate"><span class="pre">spec</span></code> and <code class="docutils literal notranslate"><span class="pre">last</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ipv4 src is 10.1.1.1 src last 10.2.3.4 src mask 255.255.0.0
   # matches 10.1.0.0 to 10.2.255.255
</pre></div>
</div>
<p>Properties can be modified multiple times:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ipv4 src is 10.1.1.1 src is 10.1.2.3 src is 10.2.3.4 # matches 10.2.3.4
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ipv4 src is 10.1.1.1 src prefix 24 src prefix 16 # matches 10.1.0.0/16
</pre></div>
</div>
</div>
<div class="section" id="pattern-items">
<h4>4.10.3.3. Pattern items</h4>
<p>This section lists supported pattern items and their attributes, if any.</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">end</span></code>: end list of pattern items.</li>
<li><code class="docutils literal notranslate"><span class="pre">void</span></code>: no-op pattern item.</li>
<li><code class="docutils literal notranslate"><span class="pre">invert</span></code>: perform actions when pattern does not match.</li>
<li><code class="docutils literal notranslate"><span class="pre">any</span></code>: match any protocol for the current layer.<ul>
<li><code class="docutils literal notranslate"><span class="pre">num</span> <span class="pre">{unsigned}</span></code>: number of layers covered.</li>
</ul>
</li>
<li><code class="docutils literal notranslate"><span class="pre">pf</span></code>: match packets addressed to the physical function.</li>
<li><code class="docutils literal notranslate"><span class="pre">vf</span></code>: match packets addressed to a virtual function ID.<ul>
<li><code class="docutils literal notranslate"><span class="pre">id</span> <span class="pre">{unsigned}</span></code>: destination VF ID.</li>
</ul>
</li>
<li><code class="docutils literal notranslate"><span class="pre">port</span></code>: device-specific physical port index to use.<ul>
<li><code class="docutils literal notranslate"><span class="pre">index</span> <span class="pre">{unsigned}</span></code>: physical port index.</li>
</ul>
</li>
<li><code class="docutils literal notranslate"><span class="pre">raw</span></code>: match an arbitrary byte string.<ul>
<li><code class="docutils literal notranslate"><span class="pre">relative</span> <span class="pre">{boolean}</span></code>: look for pattern after the previous item.</li>
<li><code class="docutils literal notranslate"><span class="pre">search</span> <span class="pre">{boolean}</span></code>: search pattern from offset (see also limit).</li>
<li><code class="docutils literal notranslate"><span class="pre">offset</span> <span class="pre">{integer}</span></code>: absolute or relative offset for pattern.</li>
<li><code class="docutils literal notranslate"><span class="pre">limit</span> <span class="pre">{unsigned}</span></code>: search area limit for start of pattern.</li>
<li><code class="docutils literal notranslate"><span class="pre">pattern</span> <span class="pre">{string}</span></code>: byte string to look for.</li>
</ul>
</li>
<li><code class="docutils literal notranslate"><span class="pre">eth</span></code>: match Ethernet header.<ul>
<li><code class="docutils literal notranslate"><span class="pre">dst</span> <span class="pre">{MAC-48}</span></code>: destination MAC.</li>
<li><code class="docutils literal notranslate"><span class="pre">src</span> <span class="pre">{MAC-48}</span></code>: source MAC.</li>
<li><code class="docutils literal notranslate"><span class="pre">type</span> <span class="pre">{unsigned}</span></code>: EtherType.</li>
</ul>
</li>
<li><code class="docutils literal notranslate"><span class="pre">vlan</span></code>: match 802.1Q/ad VLAN tag.<ul>
<li><code class="docutils literal notranslate"><span class="pre">tpid</span> <span class="pre">{unsigned}</span></code>: tag protocol identifier.</li>
<li><code class="docutils literal notranslate"><span class="pre">tci</span> <span class="pre">{unsigned}</span></code>: tag control information.</li>
<li><code class="docutils literal notranslate"><span class="pre">pcp</span> <span class="pre">{unsigned}</span></code>: priority code point.</li>
<li><code class="docutils literal notranslate"><span class="pre">dei</span> <span class="pre">{unsigned}</span></code>: drop eligible indicator.</li>
<li><code class="docutils literal notranslate"><span class="pre">vid</span> <span class="pre">{unsigned}</span></code>: VLAN identifier.</li>
</ul>
</li>
<li><code class="docutils literal notranslate"><span class="pre">ipv4</span></code>: match IPv4 header.<ul>
<li><code class="docutils literal notranslate"><span class="pre">tos</span> <span class="pre">{unsigned}</span></code>: type of service.</li>
<li><code class="docutils literal notranslate"><span class="pre">ttl</span> <span class="pre">{unsigned}</span></code>: time to live.</li>
<li><code class="docutils literal notranslate"><span class="pre">proto</span> <span class="pre">{unsigned}</span></code>: next protocol ID.</li>
<li><code class="docutils literal notranslate"><span class="pre">src</span> <span class="pre">{ipv4</span> <span class="pre">address}</span></code>: source address.</li>
<li><code class="docutils literal notranslate"><span class="pre">dst</span> <span class="pre">{ipv4</span> <span class="pre">address}</span></code>: destination address.</li>
</ul>
</li>
<li><code class="docutils literal notranslate"><span class="pre">ipv6</span></code>: match IPv6 header.<ul>
<li><code class="docutils literal notranslate"><span class="pre">tc</span> <span class="pre">{unsigned}</span></code>: traffic class.</li>
<li><code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">{unsigned}</span></code>: flow label.</li>
<li><code class="docutils literal notranslate"><span class="pre">proto</span> <span class="pre">{unsigned}</span></code>: protocol (next header).</li>
<li><code class="docutils literal notranslate"><span class="pre">hop</span> <span class="pre">{unsigned}</span></code>: hop limit.</li>
<li><code class="docutils literal notranslate"><span class="pre">src</span> <span class="pre">{ipv6</span> <span class="pre">address}</span></code>: source address.</li>
<li><code class="docutils literal notranslate"><span class="pre">dst</span> <span class="pre">{ipv6</span> <span class="pre">address}</span></code>: destination address.</li>
</ul>
</li>
<li><code class="docutils literal notranslate"><span class="pre">icmp</span></code>: match ICMP header.<ul>
<li><code class="docutils literal notranslate"><span class="pre">type</span> <span class="pre">{unsigned}</span></code>: ICMP packet type.</li>
<li><code class="docutils literal notranslate"><span class="pre">code</span> <span class="pre">{unsigned}</span></code>: ICMP packet code.</li>
</ul>
</li>
<li><code class="docutils literal notranslate"><span class="pre">udp</span></code>: match UDP header.<ul>
<li><code class="docutils literal notranslate"><span class="pre">src</span> <span class="pre">{unsigned}</span></code>: UDP source port.</li>
<li><code class="docutils literal notranslate"><span class="pre">dst</span> <span class="pre">{unsigned}</span></code>: UDP destination port.</li>
</ul>
</li>
<li><code class="docutils literal notranslate"><span class="pre">tcp</span></code>: match TCP header.<ul>
<li><code class="docutils literal notranslate"><span class="pre">src</span> <span class="pre">{unsigned}</span></code>: TCP source port.</li>
<li><code class="docutils literal notranslate"><span class="pre">dst</span> <span class="pre">{unsigned}</span></code>: TCP destination port.</li>
</ul>
</li>
<li><code class="docutils literal notranslate"><span class="pre">sctp</span></code>: match SCTP header.<ul>
<li><code class="docutils literal notranslate"><span class="pre">src</span> <span class="pre">{unsigned}</span></code>: SCTP source port.</li>
<li><code class="docutils literal notranslate"><span class="pre">dst</span> <span class="pre">{unsigned}</span></code>: SCTP destination port.</li>
<li><code class="docutils literal notranslate"><span class="pre">tag</span> <span class="pre">{unsigned}</span></code>: validation tag.</li>
<li><code class="docutils literal notranslate"><span class="pre">cksum</span> <span class="pre">{unsigned}</span></code>: checksum.</li>
</ul>
</li>
<li><code class="docutils literal notranslate"><span class="pre">vxlan</span></code>: match VXLAN header.<ul>
<li><code class="docutils literal notranslate"><span class="pre">vni</span> <span class="pre">{unsigned}</span></code>: VXLAN identifier.</li>
</ul>
</li>
<li><code class="docutils literal notranslate"><span class="pre">e_tag</span></code>: match IEEE 802.1BR E-Tag header.<ul>
<li><code class="docutils literal notranslate"><span class="pre">grp_ecid_b</span> <span class="pre">{unsigned}</span></code>: GRP and E-CID base.</li>
</ul>
</li>
<li><code class="docutils literal notranslate"><span class="pre">nvgre</span></code>: match NVGRE header.<ul>
<li><code class="docutils literal notranslate"><span class="pre">tni</span> <span class="pre">{unsigned}</span></code>: virtual subnet ID.</li>
</ul>
</li>
<li><code class="docutils literal notranslate"><span class="pre">mpls</span></code>: match MPLS header.<ul>
<li><code class="docutils literal notranslate"><span class="pre">label</span> <span class="pre">{unsigned}</span></code>: MPLS label.</li>
</ul>
</li>
<li><code class="docutils literal notranslate"><span class="pre">gre</span></code>: match GRE header.<ul>
<li><code class="docutils literal notranslate"><span class="pre">protocol</span> <span class="pre">{unsigned}</span></code>: protocol type.</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="actions-list">
<h4>4.10.3.4. Actions list</h4>
<p>A list of actions starts after the <code class="docutils literal notranslate"><span class="pre">actions</span></code> token in the same fashion as
<a class="reference internal" href="#matching-pattern">Matching pattern</a>; actions are separated by <code class="docutils literal notranslate"><span class="pre">/</span></code> tokens and the list is
terminated by a mandatory <code class="docutils literal notranslate"><span class="pre">end</span></code> action.</p>
<p>Actions are named after their type (<em>RTE_FLOW_ACTION_TYPE_</em> from <code class="docutils literal notranslate"><span class="pre">enum</span>
<span class="pre">rte_flow_action_type</span></code>).</p>
<p>Dropping all incoming UDPv4 packets can be expressed as follows:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow create 0 ingress pattern eth / ipv4 / udp / end
   actions drop / end
</pre></div>
</div>
<p>Several actions have configurable properties which must be specified when
there is no valid default value. For example, <code class="docutils literal notranslate"><span class="pre">queue</span></code> requires a target
queue index.</p>
<p>This rule redirects incoming UDPv4 traffic to queue index 6:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow create 0 ingress pattern eth / ipv4 / udp / end
   actions queue index 6 / end
</pre></div>
</div>
<p>While this one could be rejected by PMDs (unspecified queue index):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow create 0 ingress pattern eth / ipv4 / udp / end
   actions queue / end
</pre></div>
</div>
<p>As defined by <em>rte_flow</em>, the list is not ordered, all actions of a given
rule are performed simultaneously. These are equivalent:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>queue index 6 / void / mark id 42 / end
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>void / mark id 42 / queue index 6 / end
</pre></div>
</div>
<p>All actions in a list should have different types, otherwise only the last
action of a given type is taken into account:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>queue index 4 / queue index 5 / queue index 6 / end # will use queue 6
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>drop / drop / drop / end # drop is performed only once
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>mark id 42 / queue index 3 / mark id 24 / end # mark will be 24
</pre></div>
</div>
<p>Considering they are performed simultaneously, opposite and overlapping
actions can sometimes be combined when the end result is unambiguous:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>drop / queue index 6 / end # drop has no effect
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>drop / dup index 6 / end # same as above
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>queue index 6 / rss queues 6 7 8 / end # queue has no effect
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>drop / passthru / end # drop has no effect
</pre></div>
</div>
<p>Note that PMDs may still refuse such combinations.</p>
</div>
<div class="section" id="actions">
<h4>4.10.3.5. Actions</h4>
<p>This section lists supported actions and their attributes, if any.</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">end</span></code>: end list of actions.</li>
<li><code class="docutils literal notranslate"><span class="pre">void</span></code>: no-op action.</li>
<li><code class="docutils literal notranslate"><span class="pre">passthru</span></code>: let subsequent rule process matched packets.</li>
<li><code class="docutils literal notranslate"><span class="pre">mark</span></code>: attach 32 bit value to packets.<ul>
<li><code class="docutils literal notranslate"><span class="pre">id</span> <span class="pre">{unsigned}</span></code>: 32 bit value to return with packets.</li>
</ul>
</li>
<li><code class="docutils literal notranslate"><span class="pre">flag</span></code>: flag packets.</li>
<li><code class="docutils literal notranslate"><span class="pre">queue</span></code>: assign packets to a given queue index.<ul>
<li><code class="docutils literal notranslate"><span class="pre">index</span> <span class="pre">{unsigned}</span></code>: queue index to use.</li>
</ul>
</li>
<li><code class="docutils literal notranslate"><span class="pre">drop</span></code>: drop packets (note: passthru has priority).</li>
<li><code class="docutils literal notranslate"><span class="pre">count</span></code>: enable counters for this rule.</li>
<li><code class="docutils literal notranslate"><span class="pre">dup</span></code>: duplicate packets to a given queue index.<ul>
<li><code class="docutils literal notranslate"><span class="pre">index</span> <span class="pre">{unsigned}</span></code>: queue index to duplicate packets to.</li>
</ul>
</li>
<li><code class="docutils literal notranslate"><span class="pre">rss</span></code>: spread packets among several queues.<ul>
<li><code class="docutils literal notranslate"><span class="pre">queues</span> <span class="pre">[{unsigned}</span> <span class="pre">[...]]</span> <span class="pre">end</span></code>: queue indices to use.</li>
</ul>
</li>
<li><code class="docutils literal notranslate"><span class="pre">pf</span></code>: redirect packets to physical device function.</li>
<li><code class="docutils literal notranslate"><span class="pre">vf</span></code>: redirect packets to virtual device function.<ul>
<li><code class="docutils literal notranslate"><span class="pre">original</span> <span class="pre">{boolean}</span></code>: use original VF ID if possible.</li>
<li><code class="docutils literal notranslate"><span class="pre">id</span> <span class="pre">{unsigned}</span></code>: VF ID to redirect packets to.</li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="destroying-flow-rules">
<h3>4.10.4. Destroying flow rules</h3>
<p><code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">destroy</span></code> destroys one or more rules from their rule ID (as returned
by <code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">create</span></code>), this command calls <code class="docutils literal notranslate"><span class="pre">rte_flow_destroy()</span></code> as many
times as necessary:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow destroy {port_id} rule {rule_id} [...]
</pre></div>
</div>
<p>If successful, it will show:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Flow rule #[...] destroyed
</pre></div>
</div>
<p>It does not report anything for rule IDs that do not exist. The usual error
message is shown when a rule cannot be destroyed:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Caught error type [...] ([...]): [...]
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">flush</span></code> destroys all rules on a device and does not take extra
arguments. It is bound to <code class="docutils literal notranslate"><span class="pre">rte_flow_flush()</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow flush {port_id}
</pre></div>
</div>
<p>Any errors are reported as above.</p>
<p>Creating several rules and destroying them:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow create 0 ingress pattern eth / ipv6 / end
   actions queue index 2 / end
Flow rule #0 created
testpmd&gt; flow create 0 ingress pattern eth / ipv4 / end
   actions queue index 3 / end
Flow rule #1 created
testpmd&gt; flow destroy 0 rule 0 rule 1
Flow rule #1 destroyed
Flow rule #0 destroyed
testpmd&gt;
</pre></div>
</div>
<p>The same result can be achieved using <code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">flush</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow create 0 ingress pattern eth / ipv6 / end
   actions queue index 2 / end
Flow rule #0 created
testpmd&gt; flow create 0 ingress pattern eth / ipv4 / end
   actions queue index 3 / end
Flow rule #1 created
testpmd&gt; flow flush 0
testpmd&gt;
</pre></div>
</div>
<p>Non-existent rule IDs are ignored:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow create 0 ingress pattern eth / ipv6 / end
   actions queue index 2 / end
Flow rule #0 created
testpmd&gt; flow create 0 ingress pattern eth / ipv4 / end
   actions queue index 3 / end
Flow rule #1 created
testpmd&gt; flow destroy 0 rule 42 rule 10 rule 2
testpmd&gt;
testpmd&gt; flow destroy 0 rule 0
Flow rule #0 destroyed
testpmd&gt;
</pre></div>
</div>
</div>
<div class="section" id="querying-flow-rules">
<h3>4.10.5. Querying flow rules</h3>
<p><code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">query</span></code> queries a specific action of a flow rule having that
ability. Such actions collect information that can be reported using this
command. It is bound to <code class="docutils literal notranslate"><span class="pre">rte_flow_query()</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow query {port_id} {rule_id} {action}
</pre></div>
</div>
<p>If successful, it will display either the retrieved data for known actions
or the following message:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Cannot display result for action type [...] ([...])
</pre></div>
</div>
<p>Otherwise, it will complain either that the rule does not exist or that some
error occurred:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Flow rule #[...] not found
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Caught error type [...] ([...]): [...]
</pre></div>
</div>
<p>Currently only the <code class="docutils literal notranslate"><span class="pre">count</span></code> action is supported. This action reports the
number of packets that hit the flow rule and the total number of bytes. Its
output has the following format:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>count:
 hits_set: [...] # whether &quot;hits&quot; contains a valid value
 bytes_set: [...] # whether &quot;bytes&quot; contains a valid value
 hits: [...] # number of packets
 bytes: [...] # number of bytes
</pre></div>
</div>
<p>Querying counters for TCPv6 packets redirected to queue 6:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow create 0 ingress pattern eth / ipv6 / tcp / end
   actions queue index 6 / count / end
Flow rule #4 created
testpmd&gt; flow query 0 4 count
count:
 hits_set: 1
 bytes_set: 0
 hits: 386446
 bytes: 0
testpmd&gt;
</pre></div>
</div>
</div>
<div class="section" id="listing-flow-rules">
<h3>4.10.6. Listing flow rules</h3>
<p><code class="docutils literal notranslate"><span class="pre">flow</span> <span class="pre">list</span></code> lists existing flow rules sorted by priority and optionally
filtered by group identifiers:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>flow list {port_id} [group {group_id}] [...]
</pre></div>
</div>
<p>This command only fails with the following message if the device does not
exist:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Invalid port [...]
</pre></div>
</div>
<p>Output consists of a header line followed by a short description of each
flow rule, one per line. There is no output at all when no flow rules are
configured on the device:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ID      Group   Prio    Attr    Rule
[...]   [...]   [...]   [...]   [...]
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Attr</span></code> column flags:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">i</span></code> for <code class="docutils literal notranslate"><span class="pre">ingress</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">e</span></code> for <code class="docutils literal notranslate"><span class="pre">egress</span></code>.</li>
</ul>
<p>Creating several flow rules and listing them:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow create 0 ingress pattern eth / ipv4 / end
   actions queue index 6 / end
Flow rule #0 created
testpmd&gt; flow create 0 ingress pattern eth / ipv6 / end
   actions queue index 2 / end
Flow rule #1 created
testpmd&gt; flow create 0 priority 5 ingress pattern eth / ipv4 / udp / end
   actions rss queues 6 7 8 end / end
Flow rule #2 created
testpmd&gt; flow list 0
ID      Group   Prio    Attr    Rule
0       0       0       i-      ETH IPV4 =&gt; QUEUE
1       0       0       i-      ETH IPV6 =&gt; QUEUE
2       0       5       i-      ETH IPV4 UDP =&gt; RSS
testpmd&gt;
</pre></div>
</div>
<p>Rules are sorted by priority (i.e. group ID first, then priority level):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow list 1
ID      Group   Prio    Attr    Rule
0       0       0       i-      ETH =&gt; COUNT
6       0       500     i-      ETH IPV6 TCP =&gt; DROP COUNT
5       0       1000    i-      ETH IPV6 ICMP =&gt; QUEUE
1       24      0       i-      ETH IPV4 UDP =&gt; QUEUE
4       24      10      i-      ETH IPV4 TCP =&gt; DROP
3       24      20      i-      ETH IPV4 =&gt; DROP
2       24      42      i-      ETH IPV4 UDP =&gt; QUEUE
7       63      0       i-      ETH IPV6 UDP VXLAN =&gt; MARK QUEUE
testpmd&gt;
</pre></div>
</div>
<p>Output can be limited to specific groups:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow list 1 group 0 group 63
ID      Group   Prio    Attr    Rule
0       0       0       i-      ETH =&gt; COUNT
6       0       500     i-      ETH IPV6 TCP =&gt; DROP COUNT
5       0       1000    i-      ETH IPV6 ICMP =&gt; QUEUE
7       63      0       i-      ETH IPV6 UDP VXLAN =&gt; MARK QUEUE
testpmd&gt;
</pre></div>
</div>
</div>
<div class="section" id="sample-qinq-flow-rules">
<h3>4.10.7. Sample QinQ flow rules</h3>
<p>Before creating QinQ rule(s) the following commands should be issued to enable QinQ:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; port stop 0
testpmd&gt; vlan set qinq on 0
</pre></div>
</div>
<p>The above command sets the inner and outer TPID's to 0x8100.</p>
<p>To change the TPID's the following commands should be used:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; vlan set outer tpid 0xa100 0
testpmd&gt; vlan set inner tpid 0x9100 0
testpmd&gt; port start 0
</pre></div>
</div>
<p>Validate and create a QinQ rule on port 0 to steer traffic to a VF queue in a VM.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow validate 0 ingress pattern eth / vlan tci is 123 /
    vlan tci is 456 / end actions vf id 1 / queue index 0 / end
Flow rule #0 validated

testpmd&gt; flow create 0 ingress pattern eth / vlan tci is 4 /
    vlan tci is 456 / end actions vf id 123 / queue index 0 / end
Flow rule #0 created

testpmd&gt; flow list 0
ID      Group   Prio    Attr    Rule
0       0       0       i-      ETH VLAN VLAN=&gt;VF QUEUE
</pre></div>
</div>
<p>Validate and create a QinQ rule on port 0 to steer traffic to a queue on the host.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testpmd&gt; flow validate 0 ingress pattern eth / vlan tci is 321 /
     vlan tci is 654 / end actions pf / queue index 0 / end
Flow rule #1 validated

testpmd&gt; flow create 0 ingress pattern eth / vlan tci is 321 /
     vlan tci is 654 / end actions pf / queue index 1 / end
Flow rule #1 created

testpmd&gt; flow list 0
ID      Group   Prio    Attr    Rule
0       0       0       i-      ETH VLAN VLAN=&gt;VF QUEUE
1       0       0       i-      ETH VLAN VLAN=&gt;PF QUEUE
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../nics/index.html" class="btn btn-neutral float-right" title="Network Interface Controller Drivers" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="run_app.html" class="btn btn-neutral" title="3. Running the Application" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'17.05.0-rc4',
            LANGUAGE:'zh',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>